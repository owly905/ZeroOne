if (!hasInterface) exitWith {}; if(!isNil 'zero_var_allowedLockerPrimary' && {serverTime - zero_var_allowedLockerPrimary < 3}) exitWith {"Gedulde dich beim heraus- und hineinlegen" call zero_fnc_msg;}; private ["_targetControl","_sourceControl","_data","_newPrimaryWeapon","_oldPrimaryWeapon","_itemSilencer","_itemOptic","_itemPointer","_itemBipod","_defaultPic"]; disableSerialization; _targetControl = param[0,controlNull,[controlNull]]; _sourceControl = param[3,0,[0]]; _data = param[4,[],[[]]]; _data = _data select 0; _newPrimaryWeapon = toLower(_data select 2); if(_newPrimaryWeapon isEqualTo "") exitWith {}; _oldPrimaryWeapon = toLower(_targetControl lbData 0); if(ctrlIDC _targetControl isEqualTo _sourceControl) exitWith {}; if(ctrlIDC _targetControl == 1601 && (((getNumber(configFile >> "CfgWeapons" >> _newPrimaryWeapon >> "ItemInfo" >> "type")) in [101,201,301,302]) || (isClass(configFile >> "CfgMagazines" >> _newPrimaryWeapon)))) exitWith {"Das passt hier nicht" call zero_fnc_msg;}; if(ctrlIDC _targetControl == 1600 && (!(_sourceControl in [1601,1602,1603,1604,1605]))) exitWith {"Das passt hier nicht" call zero_fnc_msg;}; if(!(_sourceControl in [1600,1601,1602,1603,1604,1605])) exitWith {"Das passt hier nicht" call zero_fnc_msg;}; zero_var_allowedLockerPrimary = serverTime; _itemSilencer = (findDisplay 1000) displayCtrl 1602; _itemOptic = (findDisplay 1000) displayCtrl 1603; _itemPointer = (findDisplay 1000) displayCtrl 1604; _itemBipod = (findDisplay 1000) displayCtrl 1605; if(_sourceControl isEqualTo 1600) then { lbClear _targetControl; _targetControl lbAdd format ["   %1",getText (configFile >> "CfgWeapons" >> _newPrimaryWeapon >> "displayName")]; _targetControl lbSetTooltip [lbSize(_targetControl) - 1, getText (configFile >> "CfgWeapons" >> _newPrimaryWeapon >> "displayName")]; _targetControl lbSetPicture [lbSize(_targetControl) - 1, getText (configFile >> "CfgWeapons" >> _newPrimaryWeapon >> "picture")]; _targetControl lbSetValue [lbSize(_targetControl) - 1, 1]; _targetControl lbSetData [lbSize(_targetControl) - 1, _newPrimaryWeapon]; [toLower(_newPrimaryWeapon),-1] call zero_fnc_addItemToLocker; if(!(_oldPrimaryWeapon isEqualTo "")) then { [toLower(_oldPrimaryWeapon),1] call zero_fnc_addItemToLocker; }; if((primaryWeapon player) != _newPrimaryWeapon) then { player addWeapon _newPrimaryWeapon; }; removeAllPrimaryWeaponItems player; if((_itemSilencer lbData 0) != "") then {player addPrimaryWeaponItem (_itemSilencer lbData 0)};
if((_itemOptic lbData 0) != "") then {player addPrimaryWeaponItem (_itemOptic lbData 0)}; if((_itemPointer lbData 0) != "") then {player addPrimaryWeaponItem (_itemPointer lbData 0)}; if((_itemBipod lbData 0) != "") then {player addPrimaryWeaponItem (_itemBipod lbData 0)}; }else{ _sourceControl = ((findDisplay 1000) displayCtrl _sourceControl); lbClear _sourceControl; if((getNumber(configFile >> "CfgWeapons" >> _newPrimaryWeapon >> "ItemInfo" >> "type")) in [101,201,301,302]) then { _defaultPic = switch (getNumber(configFile >> "CfgWeapons" >> _newPrimaryWeapon >> "ItemInfo" >> "type")) do { case 101:{"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_muzzle_gs.paa"}; case 201:{"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_top_gs.paa"}; case 301:{"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_side_gs.paa"}; case 302:{"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_bipod_gs.paa"}; default{""}; }; _sourceControl lbAdd ""; _sourceControl lbSetPicture [lbSize(_sourceControl) - 1,_defaultPic]; [toLower(_newPrimaryWeapon), 1] call zero_fnc_addItemToLocker; player removePrimaryWeaponItem _newPrimaryWeapon; }else{ if((_itemSilencer lbData 0) != "") then { [toLower((_itemSilencer lbData 0)),1] call zero_fnc_addItemToLocker; lbClear _itemSilencer; _itemSilencer lbAdd ""; _itemSilencer lbSetPicture [lbSize(_itemSilencer) - 1,"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_muzzle_gs.paa"]; }; if((_itemOptic lbData 0) != "") then { [toLower((_itemOptic lbData 0)),1] call zero_fnc_addItemToLocker; lbClear _itemOptic; _itemOptic lbAdd ""; _itemOptic lbSetPicture [lbSize(_itemOptic) - 1,"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_side_gs.paa"]; }; if((_itemPointer lbData 0) != "") then { [toLower((_itemPointer lbData 0)),1] call zero_fnc_addItemToLocker; lbClear _itemPointer; _itemPointer lbAdd ""; _itemPointer lbSetPicture [lbSize(_itemPointer) - 1,"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_top_gs.paa"]; }; if((_itemBipod lbData 0) != "") then { [toLower((_itemBipod lbData 0)),1] call zero_fnc_addItemToLocker; lbClear _itemBipod; _itemBipod lbAdd ""; _itemBipod lbSetPicture [lbSize(_itemBipod) - 1,"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_bipod_gs.paa"]; }; _sourceControl lbAdd ""; _sourceControl lbSetPicture [lbSize(_sourceControl) - 1, "\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_primary_gs.paa"]; [toLower(_newPrimaryWeapon),1] call zero_fnc_addItemToLocker; if(!((primaryWeaponMagazine player) isEqualTo [])) then {[toLower(((primaryWeaponMagazine player) select 0)), 1] call zero_fnc_addItemToLocker;}; player removeWeapon _newPrimaryWeapon; }; }; [] call zero_fnc_updateWeaponTab; _targetControl lbSetCurSel -1;
