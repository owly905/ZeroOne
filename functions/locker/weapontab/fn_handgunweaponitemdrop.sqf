if (!hasInterface) exitWith {}; private ["_source","_type","_targetControl","_sourceControl","_data","_newHandgunItem","_oldHandgunItem","_typeNumber","_handgunWeapon","_acc_p","_acc_o","_acc_m","_acc_b","_compatibleItems","_defaultPic"]; disableSerialization; _source = param[0,[],[[]]]; _type = param[1,"",[""]]; _targetControl = (_source param[0,controlNull,[controlNull]]); _sourceControl = (_source param[3,0,[0]]); _data = (_source param[4,[],[[]]]); _data = _data select 0; _newHandgunItem = toLower(_data select 2); if(_newHandgunItem isEqualTo "") exitWith {}; _oldHandgunItem = toLower(_targetControl lbData 0); _typeNumber = switch (_type) do { case "silencer": {101}; case "optic": {201}; case "pointer": {301}; case "bipod": {302}; default {-1}; }; if((getNumber(configFile >> "CfgWeapons" >> _newHandgunItem >> "ItemInfo" >> "type")) != _typeNumber || _sourceControl != 1612) exitWith {"Das passt hier nicht" call zero_fnc_msg;}; if(_sourceControl isEqualTo 1612) then { _handgunWeapon = toLower(((findDisplay 1000) displayCtrl 1613) lbData 0); if(isClass (configFile >> "CfgWeapons" >> _handgunWeapon >> "WeaponSlotsInfo")) then { _acc_p = getArray(configFile >> "CfgWeapons" >> _handgunWeapon >> "WeaponSlotsInfo" >> "PointerSlot" >> "compatibleItems"); _acc_o = getArray(configFile >> "CfgWeapons" >> _handgunWeapon >> "WeaponSlotsInfo" >> "CowsSlot" >> "compatibleItems"); _acc_m = getArray(configFile >> "CfgWeapons" >> _handgunWeapon >> "WeaponSlotsInfo" >> "MuzzleSlot" >> "compatibleItems"); _acc_b = getArray(configFile >> "CfgWeapons" >> _handgunWeapon >> "WeaponSlotsInfo" >> "UnderBarrelSlot" >> "compatibleItems");
_compatibleItems = []; {_compatibleItems set [_forEachIndex, toLower(_x)];} forEach (_acc_p + _acc_o + _acc_m + _acc_b); if(!(_newHandgunItem in (_compatibleItems))) exitWith {"Das kannst du nicht an die Waffen anbringen" call zero_fnc_msg;}; lbClear _targetControl; _targetControl lbAdd format ["   %1",getText (configFile >> "CfgWeapons" >> _newHandgunItem >> "displayName")]; _targetControl lbSetTooltip [lbSize(_targetControl) - 1, getText (configFile >> "CfgWeapons" >> _newHandgunItem >> "displayName")]; _targetControl lbSetPicture [lbSize(_targetControl) - 1, getText (configFile >> "CfgWeapons" >> _newHandgunItem >> "picture")]; _targetControl lbSetValue [lbSize(_targetControl) - 1, 1]; _targetControl lbSetData [lbSize(_targetControl) - 1, _newHandgunItem]; [toLower(_newHandgunItem),-1] call zero_fnc_addItemToLocker; if(!(_oldHandgunItem isEqualTo "")) then { [toLower(_oldHandgunItem),1] call zero_fnc_addItemToLocker; }; player addHandgunItem _newHandgunItem; }; }else{ _sourceControl = ((findDisplay 1000) displayCtrl _sourceControl); lbClear _sourceControl; _defaultPic = switch (getNumber(configFile >> "CfgWeapons" >> _newHandgunItem >> "ItemInfo" >> "type")) do { case 101:{"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_muzzle_gs.paa"}; case 201:{"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_top_gs.paa"}; case 301:{"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_side_gs.paa"}; case 302:{"\A3\Ui_f\data\GUI\Rsc\RscDisplayGear\ui_gear_bipod_gs.paa"}; default{""}; }; _sourceControl lbAdd ""; _sourceControl lbSetPicture [lbSize(_sourceControl) - 1,_defaultPic]; [toLower(_newHandgunItem),1] call zero_fnc_addItemToLocker; player removeHandgunItem _newHandgunItem; }; [] call zero_fnc_updateWeaponTab; _targetControl lbSetCurSel -1;
