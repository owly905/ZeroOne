if (!hasInterface) exitWith {}; private ["_display","_lockerItemList","_playerItemList","_loadOut","_uniformInfo","_vestInfo","_backpackInfo","_assignedItems","_playerItems","_uniformItems","_vestItems","_backpackItems","_itm"]; disableSerialization; _display = findDisplay 1000; if (isNull _display) exitWith {(str(_display)) call zero_fnc_msg;}; ["Entferne deine Aufsätze bevor du Waffen in das Schließfach legst!",1,"Info"] call zero_fnc_msg; (_display displayCtrl 1500) ctrlShow false; (_display displayCtrl 1501) ctrlShow false; (_display displayCtrl 1502) ctrlShow false; (_display displayCtrl 1503) ctrlShow false; (_display displayCtrl 1504) ctrlShow false; (_display displayCtrl 1505) ctrlShow false; (_display displayCtrl 1506) ctrlShow false; (_display displayCtrl 1507) ctrlShow false; (_display displayCtrl 1508) ctrlShow false; (_display displayCtrl 1509) ctrlShow false; (_display displayCtrl 1510) ctrlShow false; (_display displayCtrl 1511) ctrlShow false; (_display displayCtrl 1600) ctrlShow false; (_display displayCtrl 1601) ctrlShow false; (_display displayCtrl 1602) ctrlShow false; (_display displayCtrl 1603) ctrlShow false; (_display displayCtrl 1604) ctrlShow false; (_display displayCtrl 1605) ctrlShow false; (_display displayCtrl 1606) ctrlShow false; (_display displayCtrl 1607) ctrlShow false; (_display displayCtrl 1608) ctrlShow false; (_display displayCtrl 1609) ctrlShow false; (_display displayCtrl 1610) ctrlShow false; (_display displayCtrl 1611) ctrlShow false; (_display displayCtrl 1612) ctrlShow false; (_display displayCtrl 1613) ctrlShow false; (_display displayCtrl 1614) ctrlShow false; (_display displayCtrl 1615) ctrlShow false; (_display displayCtrl 1616) ctrlShow false; (_display displayCtrl 1617) ctrlShow false; (_display displayCtrl 1618) ctrlShow false; (_display displayCtrl 1619) ctrlShow false; (_display displayCtrl 1620) ctrlShow false; (_display displayCtrl 1621) ctrlShow false; _lockerItemList = _display displayCtrl 1700; _lockerItemList ctrlShow true; _playerItemList = _display displayCtrl 1701; _playerItemList ctrlShow true; (_display displayCtrl 1801) ctrlShow false; (_display displayCtrl 1802) ctrlShow false; (_display displayCtrl 1804) ctrlShow true; (_display displayCtrl 1803) ctrlShow true; lbClear _lockerItemList; lbClear _playerItemList; _loadOut = getUnitLoadout player; _uniformInfo = _loadOut select 3; _vestInfo = _loadOut select 4; _backpackInfo = _loadOut select 5; _assignedItems = _loadOut select 9; _playerItems = []; _uniformItems = if (!(_uniformInfo isEqualTo []) && {!((_uniformInfo select 1)isEqualTo [])}) then {(_uniformInfo select 1)} else { []}; _vestItems = if (!(_vestInfo isEqualTo []) && {!((_vestInfo select 1)isEqualTo [])}) then {(_vestInfo select 1)} else { []}; _backpackItems = if (!(_backpackInfo isEqualTo []) && {!((_backpackInfo select 1)isEqualTo [])}) then {(_backpackInfo select 1)} else { []};
{ private _entity = if(typeName _x == "ARRAY") then { if(typeName (_x select 0) == "ARRAY") then {toLower((_x select 0) select 0)}else{toLower(_x select 0)}; } else { toLower(_x) }; private _count = if(typeName _x == "ARRAY") then {if(count _x > 2) then {_x select 1} else {_x select 1}}else{1}; if(typeName _count == "BOOL") then {_count = 1;}; private _index = [_entity, _playerItems] call zero_fnc_findIndex; if(_index isEqualTo -1) then { _playerItems pushBack[toLower(_entity),_count]; }else{ _itm = _playerItems select _index; _playerItems set[_index,[toLower(_itm select 0),(_itm select 1) + _count]]; }; } forEach _uniformItems + _vestItems + _backpackItems + _assignedItems; _display setVariable["zero_var_playerItems",_playerItems]; { private _entity = toLower(_x select 0); if (_entity != "") then { private _count = (_x select 1); if(typeName _count == "BOOL") then {_count = 1;}; private _cfg = switch (true) do { case (isClass (configFile >> "CfgWeapons" >> _entity)):{"CfgWeapons"}; case (isClass (configFile >> "CfgVehicles" >> _entity)):{"CfgVehicles"}; case (isClass (configFile >> "CfgGlasses" >> _entity)):{"CfgGlasses"}; case (isClass (configFile >> "CfgMagazines" >> _entity)):{"CfgMagazines"}; }; _playerItemList lbAdd format ["%2 (%1)", _count, getText (configFile >> _cfg >> _entity >> "displayName")]; _playerItemList lbSetTooltip [lbSize(_playerItemList) - 1, format ["%2 (%1)", _count, getText (configFile >> _cfg >> _entity >> "displayName")]]; _playerItemList lbSetPicture [lbSize(_playerItemList) - 1, getText (configFile >> _cfg >> _entity >> "picture")]; _playerItemList lbSetValue [lbSize(_playerItemList) - 1, _count]; _playerItemList lbSetData [lbSize(_playerItemList) - 1, _entity]; }; } forEach _playerItems; { { private _entity = toLower(_x select 0); if (_entity != "") then { private _count = (_x select 1); if(typeName _count == "BOOL") then {_count = 1;}; private _cfg = switch (true) do { case (isClass (configFile >> "CfgWeapons" >> _entity)):{"CfgWeapons"}; case (isClass (configFile >> "CfgVehicles" >> _entity)):{"CfgVehicles"}; case (isClass (configFile >> "CfgGlasses" >> _entity)):{"CfgGlasses"}; case (isClass (configFile >> "CfgMagazines" >> _entity)):{"CfgMagazines"}; }; _lockerItemList lbAdd format ["%2 (%1)", _count, getText (configFile >> _cfg >> _entity >> "displayName")]; _lockerItemList lbSetTooltip [lbSize(_lockerItemList) - 1, format ["%2 (%1)", _count, getText (configFile >> _cfg >> _entity >> "displayName")]]; _lockerItemList lbSetPicture [lbSize(_lockerItemList) - 1, getText (configFile >> _cfg >> _entity >> "picture")]; _lockerItemList lbSetValue [lbSize(_lockerItemList) - 1, _count]; _lockerItemList lbSetData [lbSize(_lockerItemList) - 1, _entity]; }; } forEach _x; } forEach zero_var_locker; lbSort _lockerItemList; lbSort _playerItemList; if((lbSize(_lockerItemList) - 1) isEqualTo -1) then {_lockerItemList lbAdd "Keine Items verfügbar";}; if((lbSize(_playerItemList) - 1) isEqualTo -1) then {_playerItemList lbAdd "Keine Items verfügbar";}; _lockerItemList lbSetCurSel -1; _playerItemList lbSetCurSel -1;
