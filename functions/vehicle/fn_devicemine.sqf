if (!hasInterface) exitWith {}; private["_vehicle","_resourceZones","_zone","_weight","_itm","_vInv","_itemIndex","_time","_display","_items","_space","_sum","_itemWeight","_val","_all"]; _vehicle = param[0,objNull,[objNull]]; if(isNull _vehicle) exitWith {}; if(!isNil {_vehicle getVariable "mining"}) exitWith {(localize "STR_NOTF_DeviceIsMining") call zero_fnc_msg;}; if(fuel _vehicle isEqualTo 0) exitWith {titleText[localize "STR_NOTF_OutOfFuel","PLAIN"];}; if(!isNil "zero_var_trunk_delive_inuse") exitWith {titleText["Dein Skill läst es nicht zu mehr als ein Gerät zu Steuern.","PLAIN"];}; if(!isNil "zero_var_Delive_trunk_vehicle") exitWith {titleText["Dein Skill läst es nicht zu mehr als ein Gerät zu Steuern.","PLAIN"];}; closeDialog 0; _resourceZones = ["briefos_1","briefos_2","briefos_3","briefos_4","briefos_5","briefos_6","briefos_7","postos_1","postos_2","postos_3","postos_4","apple_1","apple_2","apple_3","apple_4","apple_5","apple_6","apple_7","peaches_1","peaches_2","peaches_3","peaches_4","peaches_5","peaches_6","peaches_7","heroin_1","cocaine_1","weed_1","grape_1","baumwolle_1","bananen_1","bananen_2","bananen_3","bananen_4","bananen_5","bananen_6","bananen_7","lead_1","lead_2","iron_1","iron_2","salt_1","sand_1","diamond_1","diamond_2","oil_1","oil_2","rock_1"]; _zone = ""; { if(player distance (getMarkerPos _x) < 150) exitWith {_zone = _x;}; } forEach _resourceZones; if(_zone isEqualTo "") exitWith {(localize "STR_NOTF_notNearResource") call zero_fnc_msg;}; [[2,_vehicle,player,[],clientOwner],"zero_fnc_trunk",zero_var_HC1_owner,false] call zero_fnc_sendPacket; waitUntil {!isNil "zero_var_sendtrunkre"}; zero_var_trunk_vehicle = zero_var_sendtrunkre; zero_var_sendtrunkre =nil; if ((typeName zero_var_trunk_vehicle) isEqualTo (typeName "")) exitWith {(localize "STR_MISC_VehInvUse") call zero_fnc_msg;}; zero_var_Delive_trunk_vehicle = zero_var_trunk_vehicle; _weight = [(getNumber(missionConfigFile >> "zero_CfgVehicles" >> (typeOf _vehicle) >> "trunk")),(zero_var_Delive_trunk_vehicle select 1)]; if((_weight select 1) >= (_weight select 0)) exitWith {(localize "STR_NOTF_DeviceFull") call zero_fnc_msg;}; _itm = switch(true) do { case (_zone in ["apple_1","apple_2","apple_3","apple_4","apple_4","apple_5","apple_6","apple_7"]): {"apple"}; case (_zone in ["peaches_1","peaches_2","peaches_3","peaches_4","peaches_5","peaches_6","peaches_7"]): {"peach"}; case (_zone in ["bananen_1","bananen_2","bananen_3","bananen_4","bananen_5","bananen_6","bananen_7"]): {"bananen"}; case (_zone in ["baumwolle_1"]): {"baumwolle"}; case (_zone in ["grape_1"]): {"grapes"}; case (_zone in ["heroin_1"]): {"heroinu"}; case (_zone in ["cocaine_1"]): {"cocaine"}; case (_zone in ["weed_1"]): {"cannabis"}; case (_zone in ["lead_1","lead_2"]): {"copperore"}; case (_zone in ["iron_1","iron_2"]): {"ironore"}; case (_zone in ["salt_1"]): {"salt"}; case (_zone in ["sand_1"]): {"sand"}; case (_zone in ["diamond_1","diamond_2"]): {"diamond"}; case (_zone in ["oil_1","oil_2"]): {"oilu"}; case (_zone in ["rock_1"]): {"rock"};
case (_zone in ["briefos_1","briefos_2","briefos_3","briefos_4","briefos_5","briefos_6","briefos_7"]): {"brief"}; case (_zone in ["postos_1","postos_2","postos_3","postos_4"]): {"paket"}; default {""}; }; if(_itm isEqualTo "") exitWith {"Bad Resource?" call zero_fnc_msg;}; _vehicle setVariable ["mining",true,true]; _all = []; {if (_x distance player < 350) then {_all pushBack _x};}forEach (allPlayers - entities "HeadlessClient_F"); [[_vehicle],"zero_fnc_soundDevice",_all,false] call zero_fnc_sendPacket; titleRsc ["zero_var_introtext","PLAIN"]; _display = (((uiNamespace getVariable "zero_var_introdisplay") displayCtrl 5501) ctrlSetText "Solange das Gerät Läuft ist der Kofferraum Geschlossen!"); while {true} do { zero_var_trunk_delive_inuse = true; if(!alive _vehicle || isNull _vehicle) exitWith {}; if(isEngineOn _vehicle) exitWith {titleText[localize "STR_NOTF_MiningStopped","PLAIN"];}; titleText[localize "STR_NOTF_DeviceMining","PLAIN"]; _time = time + 27; waitUntil { if(isEngineOn _vehicle) exitWith {titleText[localize "STR_NOTF_MiningStopped","PLAIN"]; true}; if(round(_time - time) < 1) exitWith {true}; if(!alive player) exitWith {true}; uiSleep 0.2; false }; if(isEngineOn _vehicle) exitWith {titleText[localize "STR_NOTF_MiningStopped","PLAIN"];}; if(fuel _vehicle <= 0) exitWith {titleText[localize "STR_NOTF_OutOfFuel","PLAIN"];}; if(local _vehicle) then { _vehicle setFuel (fuel _vehicle)-0.045; } else { [[_vehicle,(fuel _vehicle)-0.04],"zero_fnc_setFuel",_vehicle,false] call zero_fnc_sendPacket; }; if(fuel _vehicle <= 0) exitWith {titleText[localize "STR_NOTF_OutOfFuel","PLAIN"];}; _vInv = zero_var_Delive_trunk_vehicle; _items = _vInv select 0; _space = _vInv select 1; _itemIndex = [_itm,_items] call zero_fnc_findIndex; _weight = [(getNumber(missionConfigFile >> "zero_CfgVehicles" >> (typeOf _vehicle) >> "trunk")),(zero_var_Delive_trunk_vehicle select 1)]; _sum = [_itm,15,_weight select 1,_weight select 0] call zero_fnc_calWeightDiff; if(_sum < 2) exitWith {titleText[localize "STR_NOTF_DeviceFull","PLAIN"];}; if(typeName _sum != typeName 2) exitWith {titleText[localize "STR_NOTF_DeviceFull","PLAIN"];}; _itemWeight = (getNumber(missionConfigFile >> "zero_CfgItems" >> _itm >> "weight")) * _sum; if(_itemIndex isEqualTo -1) then { _items pushBack [_itm,_sum]; } else { _val = _items select _itemIndex select 1; _items set[_itemIndex,[_itm,_val + _sum]]; }; titleText[format[localize "STR_NOTF_DeviceMined",_sum, getText(missionConfigFile >> "zero_CfgItems" >> _itm >> "name")],"PLAIN"]; zero_var_Delive_trunk_vehicle = [_items,_space + _itemWeight]; _weight = [(getNumber(missionConfigFile >> "zero_CfgVehicles" >> (typeOf _vehicle) >> "trunk")),(zero_var_Delive_trunk_vehicle select 1)]; _sum = [_itm,15,_weight select 1,_weight select 0] call zero_fnc_calWeightDiff; if(_sum < 2) exitWith {titleText[localize "STR_NOTF_DeviceFull","PLAIN"];}; if(typeName _sum != typeName 2) exitWith {titleText[localize "STR_NOTF_DeviceFull","PLAIN"];}; if (!alive player) exitWith {}; uiSleep 2; }; _vehicle setVariable["mining",nil,true]; [[3,_vehicle,player,zero_var_Delive_trunk_vehicle,clientOwner],"zero_fnc_trunk",zero_var_HC1_owner,false] call zero_fnc_sendPacket; zero_var_trunk_delive_inuse = nil; zero_var_Delive_trunk_vehicle = nil;
