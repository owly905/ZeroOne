if (!hasInterface) exitWith {}; private["_vehicle","_displayName","_upp","_ui","_progress","_pgText","_cP","_add","_fuel"]; _vehicle = cursorObject; zero_var_interrupted = false; if(isNull _vehicle) exitWith {(localize "STR_ISTR_Jerry_NotLooking") call zero_fnc_msg;}; if(!(_vehicle isKindOf "LandVehicle") && !(_vehicle isKindOf "Air") && !(_vehicle isKindOf "Ship")) exitWith {}; if(player distance _vehicle > 7.5) exitWith {(localize "STR_ISTR_Jerry_NotNear") call zero_fnc_msg;}; if(!([false,"fuelF",1] call zero_fnc_handleZOInv)) exitWith {}; zero_var_action_inUse = true; _displayName = getText(configFile >> "CfgVehicles" >> (typeOf _vehicle) >> "displayName"); _upp = format[localize "STR_ISTR_Jerry_Process",_displayName]; disableSerialization; 5 cutRsc ["zero_var_progress","PLAIN"]; _ui = uiNamespace getVariable "zero_var_progress"; _progress = _ui displayCtrl 38201; _pgText = _ui displayCtrl 38202; _pgText ctrlSetText format["%2 (1%1)...","%",_upp]; _progress progressSetPosition 0.01; _cP = 0.01; while{true} do { if(animationState player != "AinvPknlMstpSnonWnonDnon_medic_1") then { player playActionNow "stop"; player action ["SwitchWeapon", player, player, 100];
player playMove "AinvPknlMstpSnonWnonDnon_medic_1"; }; if(isNull _ui) then { 5 cutRsc ["zero_var_progress","PLAIN"]; _ui = uiNamespace getVariable "zero_var_progress"; _progress = _ui displayCtrl 38201; _pgText = _ui displayCtrl 38202; }; _cP = _cP + 0.01; _progress progressSetPosition _cP; _pgText ctrlSetText format["%3 (%1%2)...",round(_cP * 100),"%",_upp]; if(_cP >= 1) exitWith {}; if(!alive player) exitWith {}; if(zero_var_interrupted) exitWith {}; uiSleep 0.55; }; zero_var_action_inUse = false; 5 cutText ["","PLAIN"]; player playActionNow "stop"; if(!alive player) exitWith {}; if(zero_var_interrupted) exitWith {zero_var_interrupted = false; titleText[localize "STR_NOTF_ActionCancel","PLAIN"];}; _add = switch (true) do { case (_vehicle isKindOf "LandVehicle"): {0.5}; case (_vehicle isKindOf "Air"): {0.2}; case (_vehicle isKindOf "Ship"): {0.35}; default {0.2}; }; if(!local _vehicle) then { _fuel = ((fuel _vehicle) + _add); [[_vehicle,_fuel],"zero_fnc_setFuel",_vehicle] call zero_fnc_sendPacket; } else { _vehicle setFuel ((fuel _vehicle) + _add); }; titleText[format[localize "STR_ISTR_Jerry_Success",_displayName],"PLAIN"]; [true,"fuelE",1] call zero_fnc_handleZOInv;
