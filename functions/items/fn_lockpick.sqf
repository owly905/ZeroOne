if (!hasInterface) exitWith {}; private ["_curTarget","_distance","_isVehicle","_title","_cP","_titleText","_dice","_badDistance","_val","_val2","_value","_ui","_progress"]; _curTarget = cursorObject; zero_var_interrupted = false; if(zero_var_action_inUse) exitWith {}; if(isNull _curTarget) exitWith {}; _distance = ((boundingBox _curTarget select 1) select 0) + 2; if(player distance _curTarget > _distance) exitWith {}; _isVehicle = if((_curTarget isKindOf "LandVehicle") || (_curTarget isKindOf "Ship") || (_curTarget isKindOf "Air")) then {true} else {false}; if(_isVehicle && _curTarget in zero_var_vehicles) exitWith {(localize "STR_ISTR_Lock_AlreadyHave") call zero_fnc_msg;}; if(!_isVehicle && !isPlayer _curTarget) exitWith {}; if(!_isVehicle && !(_curTarget getVariable["zero_var_restrained",false])) exitWith {}; if(_isVehicle && _curTarget getVariable["zero_var_vehicle_side", ""] == "med") exitWith {(localize "STR_NOTF_Hands_Off") call zero_fnc_msg;}; private _exit = false; if(playerSide != independent) then { if(_curTarget getVariable ["zero_var_restrained_ziptie", false]) then { if(!([false, "scissor", 1] call zero_fnc_handleZOInv)) then { if(!([false, "lockpick", 1] call zero_fnc_handleZOInv)) then { _exit = true; (localize "STR_NOTF_LockpickLack") call zero_fnc_msg; }; }; }else{ if(!([false, "lockpick", 1] call zero_fnc_handleZOInv)) then { _exit = true; (localize "STR_NOTF_LockpickLack") call zero_fnc_msg; }; }; }; if(_exit) exitWith {}; _title = format[localize "STR_ISTR_Lock_Process",if(!_isVehicle) then {"Handschellen"} else {getText(configFile >> "CfgVehicles" >> (typeOf _curTarget) >> "displayName")}]; zero_var_action_inUse = true; _value = ["lockpick"] call zero_fnc_getSkillValueCharacter; _val = _value select 0; _val2 = _value select 1; disableSerialization; 5 cutRsc ["zero_var_progress","PLAIN"]; _ui = uiNamespace getVariable "zero_var_progress"; _progress = _ui displayCtrl 38201; _titleText = _ui displayCtrl 38202; _titleText ctrlSetText format["%2 (1%1)...","%",_title]; _progress progressSetPosition 0.01; _cP = 0.01; for "_i" from 0 to 100 step 1 do { if(animationState player != "AinvPknlMstpsnonWnonDnon_medic_1" ) then { player action ["SwitchWeapon", player, player, 100]; player playMove "AinvPknlMstpsnonWnonDnon_medic_1"; player playActionNow "stop"; player playMove "AinvPknlMstpsnonWnonDnon_medic_1"; player playActionNow "stop"; player playMove "AinvPknlMstpsnonWnonDnon_medic_1"; }; uiSleep _val; _cP = _cP + 0.01; if (playerSide isEqualTo independent || playerSide isEqualTo west) then { _cP = _cP + 0.02; }; _progress progressSetPosition _cP; _titleText ctrlSetText format["%3 (%1%2)...",round(_cP * 100),"%",_title];
if(_cP >= 1 || !alive player) exitWith {}; if(zero_var_istazed) exitWith {}; if(zero_var_interrupted || (vehicle player) != player) exitWith {zero_var_interrupted = true;}; if(player getVariable["zero_var_restrained",false]) exitWith {}; if(player distance _curTarget > _distance) exitWith {_badDistance = true;}; }; zero_var_action_inUse = false; 5 cutText ["","PLAIN"]; player playActionNow "stop"; if(!alive player || zero_var_istazed || (player getVariable["zero_var_restrained",false])) exitWith {zero_var_action_inUse = false;}; if(!isNil "_badDistance") exitWith {titleText[localize "STR_ISTR_Lock_TooFar","PLAIN"]; zero_var_action_inUse = false;}; if(zero_var_interrupted) exitWith {zero_var_interrupted = false; titleText[localize "STR_NOTF_ActionCancel","PLAIN"]; zero_var_action_inUse = false;}; zero_var_action_inUse = false; ["lockpick"] call zero_fnc_improveSkillCharacter; if(!_isVehicle) then { _curTarget setVariable["zero_var_restrained",false,true]; if(_curTarget getVariable ["zero_var_restrained_ziptie", false]) then { _curTarget setVariable ["zero_var_restrained_ziptie", nil, true]; }; _curTarget setVariable["zero_var_escorting",false,true]; _curTarget setVariable["zero_var_transporting",false,true]; [[1],"zero_fnc_useBag",_curTarget] call zero_fnc_sendPacket; detach _curTarget; [[0, format [localize "STR_NOTF_Unrestrain", _curTarget getVariable ["zero_var_realname", name _curTarget], player getVariable ["zero_var_realname", name player]]],"zero_fnc_broadcast", west] call zero_fnc_sendPacket; } else { if(playerSide isEqualTo independent)exitWith{titleText[localize "STR_ISTR_Lock_Success","PLAIN"]; zero_var_vehicles pushBack _curTarget;}; private _all = []; {if (_x distance player < 1500) then {_all pushBack _x};}forEach (allPlayers - entities "HeadlessClient_F"); [[_curTarget],"zero_fnc_CarAlarmSound",_all,false] call zero_fnc_sendPacket; _dice = random(100); if(_dice < _val2) then { titleText[localize "STR_ISTR_Lock_Success","PLAIN"]; zero_var_vehicles pushBack _curTarget; [7,getPlayerUID player,profileName] call zero_fnc_wantedViaScript; [format ["LOCKPICK: %1 (%2,%3) knackte folgendes Fahrzeug: %4 (%7, Besitzer: %5, Alle Besitzer: %6)", player getVariable ["zero_var_realname",name player], getPlayerUID player, playerSide, getText(missionConfigFile >> "zero_CfgVehicles" >> (typeOf _curTarget) >> "logname"), _curTarget getVariable ["zero_var_vehicle_real_owner", "Niemand"], _curTarget getVariable ["zero_var_vehicle_owners",[]], _curTarget getVariable ["zero_var_vehicle_side", side _curTarget]]] call zero_fnc_zoLog; } else { [8,getPlayerUID player,profileName] call zero_fnc_wantedViaScript; [[0,format[localize "STR_ISTR_Lock_FailedNOTF",profileName]],"zero_fnc_broadcast",west] call zero_fnc_sendPacket; titleText[localize "STR_ISTR_Lock_Failed","PLAIN"]; }; };
