if (!hasInterface) exitWith {}; if(!isNull (objectParent player)) exitWith {(localize "STR_NOTF_VehicleGetOut") call zero_fnc_msg;}; if(zero_var_delivery_in_progress) exitWith {(localize "STR_NOTF_Already_DP") call zero_fnc_msg;}; private _target = (["dp"] call zero_fnc_getNearestMarker) select 0; private _dpPoints = getArray(missionConfigFile >> "zero_CfgInteractions" >> "dpMarker"); _dpPoints deleteAt (_dpPoints find _target); private _dp = selectRandom _dpPoints; zero_var_dp_start = _target; zero_var_delivery_in_progress = true; zero_var_dp_point = _dp; private _split = [_dp, "_"] call zero_fnc_splitString; _dp = format["%1%2",_split select 0, _split select 1];
zero_var_cur_task = player createSimpleTask [format["Delivery_%1", zero_var_dp_point]]; zero_var_cur_task setSimpleTaskDescription [format[localize "STR_NOTF_DPStart",toUpper _dp],"Delivery Job",""]; zero_var_cur_task setTaskState "Assigned"; player setCurrentTask zero_var_cur_task; [format[localize "STR_NOTF_DPTask",toUpper _dp],2] call zero_fnc_msg; [] spawn { waitUntil {uiSleep 1; !zero_var_delivery_in_progress || {!alive player}}; if(!alive player) then { zero_var_cur_task setTaskState "Failed"; player removeSimpleTask zero_var_cur_task; [localize "STR_NOTF_DPFailed",2] call zero_fnc_msg; zero_var_delivery_in_progress = false; zero_var_dp_point = nil; }; };
