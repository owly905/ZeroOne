if (!hasInterface) exitWith {}; private["_vehicle","_type","_price","_vehicleData","_upp","_ui","_progress","_pgText","_cP","_vehicleName","_val","_impound","_toLog"]; _vehicle = cursorObject; if(!((_vehicle isKindOf "Car") || (_vehicle isKindOf "Air") || (_vehicle isKindOf "Ship"))) exitWith {}; if(player distance cursorObject > 10) exitWith {}; _vehicleData = _vehicle getVariable["zero_var_vehicle_real_owner",[]]; if(_vehicleData isEqualTo []) exitWith { [_vehicle] call zero_fnc_deleteVehicle; }; _impound = false; if(playerSide isEqualTo west && (_vehicle getVariable["zero_var_vehicle_side",""] != "cop") && (_vehicle getVariable["zero_var_vehicle_side",""] != "med")) then { _impound = [ "Soll das Fahrzeug auf den Abstellhof oder in die Garage?", "Fahrzeug auf Abstellhof/in Garage", "Abstellhof", "In Garage" ] call BIS_fnc_guiMessage; }; _vehicleName = getText(configFile >> "CfgVehicles" >> (typeOf _vehicle) >> "displayName"); _ownerobj = objNull; if(playerSide isEqualTo west) then { _uid = (_vehicle getVariable ["zero_var_vehicle_real_owner",["-1"]]) select 0; { if((getplayeruid _x) isEqualTO _uid) exitWith { _ownerobj = _x; }; } forEach playableUnits; if(!isNull _ownerobj) then { [[0,format[localize "STR_NOTF_BeingImpounded",_vehicleData select 1,_vehicleName,if(_impound)then{"beschlagnahmt"}else{"abgeschleppt"}]],"zero_fnc_broadcast", _ownerobj] call zero_fnc_sendPacket} } else { [[0,format[localize "STR_NOTF_BeingImpounded",_vehicleData select 1,_vehicleName,if(_impound)then{"beschlagnahmt"}else{"abgeschleppt"}]],"zero_fnc_broadcast", (allPlayers - entities "HeadlessClient_F")] call zero_fnc_sendPacket; }; zero_var_action_inUse = true; _val = ["impound"] call zero_fnc_getSkillValueCharacter; _upp = localize "STR_NOTF_Impounding"; disableSerialization; 5 cutRsc ["zero_var_progress","PLAIN"]; _ui = uiNamespace getVariable "zero_var_progress"; _progress = _ui displayCtrl 38201; _pgText = _ui displayCtrl 38202; _pgText ctrlSetText format["%2 (1%1)...","%",_upp]; _progress progressSetPosition 0.01;
_cP = 0.01; for "_i" from 0 to 100 step 1 do { uiSleep _val; _cP = _cP + 0.01; _progress progressSetPosition _cP; _pgText ctrlSetText format["%3 (%1%2)...",round(_cP * 100),"%",_upp]; if(_cP >= 1) exitWith {}; if((player distance _vehicle > 10) || !alive player || (vehicle player) != player) exitWith {}; }; 5 cutText ["","PLAIN"]; zero_var_action_inUse = false; if((player distance _vehicle > 10) || !alive player || (vehicle player) != player) exitWith {(localize "STR_NOTF_ImpoundingCancelled") call zero_fnc_msg; zero_var_action_inUse = false;}; _classname = typeof _vehicle; _type = getText(configFile >> "CfgVehicles" >> _classname >> "displayName"); switch (true) do { case (_vehicle isKindOf "Car"): {_price = 15500;}; case (_vehicle isKindOf "Ship"): {_price = 22000;}; case (_vehicle isKindOf "Air"): {_price = 35500;}; default {_price = 5000;}; }; if(playerSide isEqualTo independent) then { _price = 10000; }; zero_var_impound_inuse = true; [[_vehicle,true,clientOwner,_impound,getPlayerUID player],"zero_fnc_vehicleStore",zero_var_HC1_owner,false] call zero_fnc_sendPacket; waitUntil {!zero_var_impound_inuse}; [format[localize "STR_NOTF_Impounded",_type,_price],1] call zero_fnc_msg; if(playerSide isEqualTo WEST) then { if(!isNull _ownerobj) then { [[0,format[localize "STR_NOTF_HasImpounded",player getVariable["zero_var_realname",name player],_vehicleData select 1,_vehicleName]],"zero_fnc_broadcast", _ownerobj] call zero_fnc_sendPacket; }; } else { [[0,format[localize "STR_NOTF_HasImpounded",player getVariable["zero_var_realname",name player],_vehicleData select 1,_vehicleName]],"zero_fnc_broadcast", (allPlayers - entities "HeadlessClient_F")] call zero_fnc_sendPacket; }; [0, ([2, 0] call zero_fnc_Z0Check) + _price] call zero_fnc_Z0Check; ["impound"] call zero_fnc_improveSkillCharacter; _toLog = format ["IMPOUNDED: %1 von %2 wurde von %3 (%4,%5) %6",getText(missionConfigFile >> "zero_CfgVehicles" >> _classname >> "logname"),_vehicle getVariable["zero_var_vehicle_real_owner","Unbekannt"], player getVariable["zero_var_realname",getPlayerUID player], getPlayerUID player, playerSide,if(_impound) then {"beschlagnahmt"}else{"abgeschleppt"}]; [_toLog] call zero_fnc_zoLog;
