if (!hasInterface) exitWith {}; private["_bad","_time","_stones","_esc","_countDown","_money"]; _bad = param[0,false,[false]]; _time = param[1,15,[0]]; zero_var_jail_stones_needed = round(_time * 5); if (!(profileNamespace getVariable["zero_jailTime",-1] isEqualTo -1)) then { _time = profileNamespace getVariable "zero_jailTime"; }; _time = time + (_time * 60); _esc = false; _stones = false; if(_time <= 0) then { _time = time + (15 * 60);}; profileNamespace setVariable["zero_jailTime",round(round(_time - time) / 60)]; while {true} do { if((round(_time - time)) > 0) then { _countDown = if(round (_time - time) > 60) then {format["%1 Minute(n)",round(round(_time - time) / 60)]} else {format["%1 Sekunde(n))",round(_time - time)]}; if(_stones) then { hintSilent format[localize "STR_Jail_JailDisplay",_countDown]; }else{ hintSilent format[localize "STR_Jail_JailDisplayStones",_countDown,[zero_var_jail_stones_needed - zero_var_jail_stones] call zero_fnc_numberText]; }; }; if(player distance (getMarkerPos "jail") > 75) exitWith { uiSleep 1; if(zero_var_killed || !alive player) exitWith {}; _esc = true; }; if((round(_time - time)) < 1) exitWith {}; if(!alive player && ((round(_time - time)) > 0)) exitWith { zero_var_jail_stones = 0; zero_var_jail_stones_needed = 1000; }; if(zero_var_killed && ((round(_time - time)) > 0)) exitWith {}; if(zero_var_jail_stones >= zero_var_jail_stones_needed && !_stones) then { titleText["Du hast dir deinen Freigang jetzt erarbeitet","PLAIN"]; [[player, "zero_var_fnc_setPos", [player, (getMarkerPos "jail")]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket;
_stones = true; }; profileNamespace setVariable["zero_jailTime",round(round(_time - time) / 60)]; uiSleep 1; }; switch (true) do { case (_esc): { zero_var_is_arrested = false; zero_var_jail_stones = 0; zero_var_jail_stones_needed = 1000; [localize "STR_Jail_EscapeSelf",-1] call zero_fnc_msg; [[0,format[localize "STR_Jail_EscapeNOTF",player getVariable["zero_var_realname",name player]]],"zero_fnc_broadcast",(allPlayers - entities "HeadlessClient_F")] call zero_fnc_sendPacket; [10,getPlayerUID player,player getVariable["zero_var_realname",name player]] call zero_fnc_wantedViaScript; [4] call zero_fnc_updatePartial; }; case (alive player && !_esc && !zero_var_killed): { zero_var_is_arrested = false; [localize "STR_Jail_Released",-1] call zero_fnc_msg; [[getPlayerUID player,player getVariable["zero_var_realname",name player]],"zero_fnc_wantedRemove",zero_var_HC1_owner] call zero_fnc_sendPacket; [[player, "zero_var_fnc_setPos", [player, (getMarkerPos "jail_release")]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; [1] call zero_fnc_removeLicenses; [2] call zero_fnc_updatePartial; [4] call zero_fnc_updatePartial; if(zero_var_jail_stones > 0) then { _money = zero_var_jail_stones*50; titleText[format["Du hast im Gefängnis %1€ verdient.",[_money] call zero_fnc_numberText],"PLAIN"]; [0, ([2, 0] call zero_fnc_Z0Check) + _money] call zero_fnc_Z0Check; }; zero_var_jail_stones = 0; zero_var_jail_stones_needed = 1000; }; default {}; }; profileNamespace setVariable["zero_jailTime",nil];
