disableSerialization; private ["_unit","_killer","_containers","_toLog","_killerName","_display","_index","_handle"]; _unit = param[0,objNull,[objNull]]; _killer = param[1,objNull,[objNull]]; if (!hasInterface) exitWith {}; if (!isNil "zero_var_exploitationtime") then { private _pos = getMarkerPos "exploitationwar"; private _size = (getMarkerSize "exploitationwarzone") select 0; if ((_killer distance _pos) > _size && (player distance _pos) > _size) exitWith {}; private _pos = getPosATL player; call zero_fnc_saveGear; [[_pos,zero_var_gear], "zero_fnc_createDeadBox", zero_var_HC1_owner, false] call zero_fnc_sendPacket; zero_var_killedInExploitationwar = true; }; if (primaryWeapon _unit != "") then { _unit removeWeapon (primaryWeapon _unit); }; if (secondaryWeapon _unit != "") then { _unit removeWeapon (secondaryWeapon _unit); }; _unit spawn { for "_i" from 0 to 10 do { {[_x] call zero_fnc_deleteVehicle; sleep 0.1;} forEach nearestObjects[getPosATL _this,["weaponholder","GroundWeaponHolder","WeaponHolderSimulated"],5]; {[_x] call zero_fnc_deleteVehicle; sleep 0.1;} forEach nearestObjects[getPosATL player,["weaponholder","GroundWeaponHolder","WeaponHolderSimulated"],5]; uiSleep 0.5; }; }; 0 spawn mav_gps_fnc_stopNavigationScripted; if(!isNull zero_var_curBox) then { zero_var_curBox setVariable[ "zero_var_antiDupe", [nil,nil] ,true]; zero_var_curBox = objNull; }; if (!isNil "zero_var_suicide") exitWith {}; if (!isNil "zero_var_lastVehicle" && {!isNull zero_var_lastVehicle} && {local zero_var_lastVehicle} && {isEngineOn zero_var_lastVehicle}) then { zero_var_lastVehicle engineOn false; zero_var_lastVehicle = nil; }; zero_var_killed = true; if(!isNull (findDisplay 175462)) then { _handle = [true] spawn zero_fnc_furniture_saveRequest; waitUntil {scriptDone _handle}; }; [] call zero_fnc_closeGUIs; if (serverTime < 13500 || ((serverTime > 15000) && (serverTime < 20700))) then { profileNamespace setVariable["zero_killed",playerSide]; }; if (isNull _killer || _unit isEqualTo _killer) then {zero_var_adrenalinAllowed = true;}; _unit spawn { zero_var_deathCamera = "CAMERA" camCreate (getPosATL _this); zero_var_deathCamera cameraEffect ["Internal","Back"]; zero_var_deathCamera camSetTarget _this; zero_var_deathCamera camSetRelPos [0,3.5,4.5]; zero_var_deathCamera camSetFovRange [1, 0.5]; zero_var_deathCamera camSetFocus [50,0]; zero_var_deathCamera camCommit 10; showCinemaBorder true; zero_var_colorCorrection = ppEffectCreate ["ColorCorrections", 200]; zero_var_dynamicBlur = ppEffectCreate ["DynamicBlur", 100]; zero_var_dynamicBlur ppEffectEnable true; zero_var_colorCorrection ppEffectEnable true; zero_var_colorCorrection ppEffectAdjust [1,0.4,0,0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0]; zero_var_colorCorrection ppEffectCommit (random 10); zero_var_dynamicBlur ppEffectAdjust [10]; zero_var_dynamicBlur ppEffectCommit 10; waitUntil {ppEffectCommitted zero_var_dynamicBlur && ppEffectCommitted zero_var_colorCorrection}; }; _killerName = if (!isNull _killer && _killer isKindOf "Man") then { if (_killer != _unit) then { format ["von %1 (%2, %3)", _killer getVariable["zero_var_realname", name _killer],side _killer, getPlayerUID _killer]; } else { "von sich selbst"; }; } else { ""; }; _toLog = format ["DEATHLOG: %1 (%2, %3) wurde %4 getoetet",player getVariable["zero_var_realname",getPlayerUID player], getPlayerUID player, playerSide,if(_killerName != "") then { format["%1",_killerName]; } else { ""; }]; [_toLog] call zero_fnc_zoLog; _unit setVariable["zero_var_deathtime",serverTime,true]; _unit setVariable["zero_var_revive",false,true]; _unit setVariable["zero_var_name",profileName,true]; _unit setVariable["zero_var_side",playerSide,true]; _unit setVariable["zero_var_restrained",false,true]; if(_unit getVariable ["zero_var_restrained_ziptie", false]) then { _unit setVariable ["zero_var_restrained_ziptie", nil, true];
}; _unit setVariable["zero_var_escorting",false,true]; _unit setVariable["zero_var_transporting",false,true]; _unit setVariable["zero_var_dead_money",([3, 0] call zero_fnc_Z0Check),true]; _unit setVariable["zero_var_playerUID",getPlayerUID player]; zero_var_escort = nil; zero_var_old_skills = zero_var_skills; player setVariable["zero_var_corpse", _unit, true]; zero_var_aborted = true; [1] call zero_fnc_useBag; zero_var_killed_lokalbank = true; (findDisplay 46) displaySetEventHandler ["KeyDown","if((_this select 1) == 1) then {true}"]; (findDisplay 46) displayRemoveAllEventHandlers "KeyDown"; (findDisplay 46) displayAddEventHandler ["KeyDown", "_this call zero_fnc_keyHandler"]; createDialog "zero_var_DeathScreen"; (findDisplay 7300) displaySetEventHandler ["KeyDown","if((_this select 1) == 1) then {true}"]; _unit spawn { disableSerialization; private _RespawnBtn = ((findDisplay 7300) displayCtrl 7302); private _MedicRequestBtn = ((findDisplay 7300) displayCtrl 7303); private _Timer = ((findDisplay 7300) displayCtrl 7301); private _adrenalin = ((findDisplay 7300) displayCtrl 7305); _adrenalin ctrlEnable false; zero_var_maxTime = time + (zero_var_respawn_timer * 60); private _medics = []; { if (alive _x && (side _x) isEqualTo independent && _x != player) then {_medics pushBack _x}; } forEach playableUnits; if (_medics isEqualTo []) then {_MedicRequestBtn ctrlEnable false;} else {_MedicRequestBtn ctrlEnable true;}; _RespawnBtn ctrlEnable false; waitUntil {_Timer ctrlSetText format[localize "STR_Medic_Respawn",[(zero_var_maxTime - time),"MM:SS.MS"] call BIS_fnc_secondsToString]; round(zero_var_maxTime - time) <= 0 || isNull _this}; _RespawnBtn ctrlEnable true; _Timer ctrlSetText localize "STR_Medic_Respawn_2"; }; [] spawn zero_fnc_deathScreen; _unit spawn { _unit = _this; waitUntil {!isNil "zero_var_deathCamera" && {!isNull zero_var_deathCamera}}; waitUntil {if(speed _unit == 0) exitWith {true}; zero_var_deathCamera camSetTarget _unit; zero_var_deathCamera camSetRelPos [0,3.5,4.5]; zero_var_deathCamera camCommit 5;}; }; if (!isNull _killer && _killer != _unit && (side _killer) != west && alive _killer) then { if(vehicle _killer isKindOf "LandVehicle") then { [3,getPlayerUID _killer,_killer getVariable["zero_var_realname",name _killer]] call zero_fnc_wantedViaScript; if(!local _killer) then { [[2],"zero_fnc_removeLicenses",_killer] call zero_fnc_sendPacket; }; } else { [4,getPlayerUID _killer,_killer getVariable["zero_var_realname",name _killer]] call zero_fnc_wantedViaScript; if (isNil "zero_var_exploitationtime") exitWith {}; private _pos = getMarkerPos "exploitationwar"; private _size = (getMarkerSize "exploitationwarzone") select 0; if ((_killer distance _pos) > _size && (player distance _pos) > _size) exitWith {}; private _group = (group _killer); if (isNull _group) exitWith {}; private _gang = _group getVariable ["zero_var_gang",[]]; if (_gang isEqualTo []) exitWith {}; private _sum = _group getVariable ["zero_var_exploitationpoints",0]; _sum = _sum + 5; _group setVariable ["zero_var_exploitationpoints",_sum]; }; }; if (!isNull _killer && side _killer isEqualTo west && (playerSide != west)) then { zero_var_copRecieve = _killer; if(!zero_var_use_atm && {([3, 0] call zero_fnc_Z0Check) > 0}) then { [[format[localize "STR_Cop_RobberDead",[([3, 0] call zero_fnc_Z0Check)] call zero_fnc_numberText]],"zero_fnc_broadcast",(allPlayers - entities "HeadlessClient_F")] call zero_fnc_sendPacket; [1, 0] call zero_fnc_Z0Check; }; }; if(!isNull _killer && {_killer != _unit}) then { zero_var_removeWanted = true; if(rating _killer < 999999) then { _killer addRating 9999999999999999; player addRating 9999999999999999; }; }; zero_var_hunger = 100; zero_var_thirst = 100; _index = ["goldbar",zero_var_inventory] call zero_fnc_findIndex; if(_index != -1) then { zero_var_inventory deleteAt _index; }; [1, 0] call zero_fnc_Z0Check; if(!(playerSide in [west,independent]))then{[] call zero_fnc_updateRequest;}; [] call zero_fnc_hudUpdate; 2 cutText [" ","PLAIN"]; [] spawn zero_fnc_killedZOCredits; [] spawn { uiSleep 2000; zero_var_killed_lokalbank = false; };
