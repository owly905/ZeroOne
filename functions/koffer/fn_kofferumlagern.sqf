if (!hasInterface) exitWith {}; private["_control","_data","_select","_menge","_value","_weight","_itemWeight","_ctrl","_index","_totalWeight","_veh_data","_inv","_val"]; disableSerialization; _control = zero_var_koffer_last_change select 0; _menge = ctrlText ((findDisplay 3100) displayCtrl 3106); _select = zero_var_koffer_last_change select 1; if(isNull zero_var_trunkCar || !alive zero_var_trunkCar) exitWith {(localize "STR_MISC_VehDoesntExist") call zero_fnc_msg;}; if(!alive player) exitWith {closeDialog 0;}; if(!([_menge] call zero_fnc_isNumber)) exitWith {(localize "STR_MISC_WrongNumFormat") call zero_fnc_msg;}; _menge = parseNumber(_menge); if(_menge < 1) exitWith {(localize "STR_MISC_Under1") call zero_fnc_msg;}; if (_control isEqualTo ((findDisplay 3100) displayCtrl 3103)) then { _ctrl = lbData [3103,_select]; if(_ctrl == "adrenalin") exitWith {"Das kannst du nicht einlagern" call zero_fnc_msg;}; if(!(zero_var_trunkCar isKindOf "Car") && (_ctrl == "danger" || _ctrl == "dangernuclear" || _ctrl == "gunpowder")) exitWith { "Das kannst du nur in Bodenfahrzeuge einlagern" call zero_fnc_msg; }; if ((typeOf zero_var_trunkCar) in ["O_Truck_03_device_F","O_T_Truck_03_device_ghex_F","O_Truck_03_covered_F","O_T_Truck_03_covered_ghex_F"] && (_ctrl == "helium3")) exitWith { "Du kannst das in dieses Fahrzeug nicht einlagern." call zero_fnc_msg; }; _totalWeight = [(getNumber(missionConfigFile >> "zero_CfgVehicles" >> (typeOf zero_var_trunkCar) >> "trunk")),(zero_var_trunk_vehicle select 1)]; _itemWeight = (getNumber(missionConfigFile >> "zero_CfgItems" >> _ctrl >> "weight")) * _menge; _veh_data = zero_var_trunk_vehicle; _inv = _veh_data select 0; if(((_totalWeight select 1) + _itemWeight) > (_totalWeight select 0)) then { _menge = (_totalWeight select 0) - (_totalWeight select 1);
_itemWeight = (getNumber(missionConfigFile >> "zero_CfgItems" >> _ctrl >> "weight")) * _menge; }; if(_menge isEqualTo 0) exitWith {(localize "STR_MISC_NotEnoughSpace") call zero_fnc_msg;}; if(!([false,_ctrl,_menge] call zero_fnc_handleZOInv)) exitWith {(localize "STR_MISC_TrunkError") call zero_fnc_msg;}; _index = [_ctrl,_inv] call zero_fnc_findIndex; if(_index isEqualTo -1) then { _inv pushBack [_ctrl,_menge]; } else { _val = _inv select _index select 1; _inv set[_index,[_ctrl,_val + _menge]]; }; zero_var_trunk_vehicle =[_inv,(_veh_data select 1) + _itemWeight]; [zero_var_trunkCar] call zero_fnc_vehInventory; } else { _ctrl = lbData [3102,_select]; _index = [_ctrl,(zero_var_trunk_vehicle select 0)] call zero_fnc_findIndex; _data = zero_var_trunk_vehicle select 0; private _old = zero_var_trunk_vehicle; if(_index == -1) exitWith {}; _value = (_data select _index) select 1; if(_menge > _value) then {_menge = _menge - (_menge - _value);}; if(_menge > _value) exitWith {(localize "STR_MISC_NotEnough") call zero_fnc_msg;}; _menge = [_ctrl,_menge,zero_var_carryWeight,zero_var_maxWeight] call zero_fnc_calWeightDiff; if(_menge <= 0) exitWith {(localize "STR_NOTF_InvFull") call zero_fnc_msg;}; _weight = ((getNumber(missionConfigFile >> "zero_CfgItems" >> _ctrl >> "weight")) * _menge); if([true,_ctrl,_menge] call zero_fnc_handleZOInv) then { _index = [_ctrl,_data] call zero_fnc_findIndex; if(_menge == _value) then { _data deleteAt _index; } else { _data set[_index,[_ctrl,(_value - _menge)]]; }; zero_var_trunk_vehicle = [_data,(_old select 1) - _weight]; [zero_var_trunkCar] call zero_fnc_vehInventory; } else { (localize "STR_NOTF_InvFull") call zero_fnc_msg; }; }; ((findDisplay 3100) displayCtrl 3103) lbSetCurSel -1; ((findDisplay 3100) displayCtrl 3102) lbSetCurSel -1;
