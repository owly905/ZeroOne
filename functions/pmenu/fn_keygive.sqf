if (!hasInterface) exitWith {}; private["_dialog","_list","_plist","_sel","_vehicle","_owners","_index","_unit","_uid"]; if(!zero_var_allowedToGive) exitWith {(localize "STR_NOTF_GiveKey") call zero_fnc_msg;}; disableSerialization; _dialog = findDisplay 2700; _list = _dialog displayCtrl 2701; _plist = _dialog displayCtrl 2702; _sel = lbCurSel _list; _vehicle = _list lbData _sel; _vehicle = zero_var_vehicles select parseNumber(_vehicle); _sel = lbCurSel _plist; _unit = _plist lbData _sel; if(zero_var_allowedToGive) then { zero_var_allowedToGive = false; [] spawn { uiSleep 5; zero_var_allowedToGive = true; }; }; if(_unit isEqualTo "group") then{ private _nearGroup=[]; { if(player distance _x < 100 && (vehicle _x) == _x && {!isObjectHidden _x})then{if(player != _x && {!isObjectHidden _x}) then {_nearGroup pushBackUnique _x};}; }forEach units(group player); { _uid = getPlayerUID _x; _owners = _vehicle getVariable "zero_var_vehicle_owners"; _index = [_uid,_owners] call zero_fnc_findIndex; if(_index isEqualTo -1) then { _owners pushBack [_uid,_x getVariable["zero_var_realname",name _x]]; _vehicle setVariable["zero_var_vehicle_owners",_owners,true]; }; if(player != _x && {!isObjectHidden _x}) then {[[_vehicle,_x,profileName],"zero_fnc_clientGetKey",_x] call zero_fnc_sendPacket;}; }forEach _nearGroup; [format["Du hast deine Schlüssel an %1 Gangmitglieder für das Fahrzeug %2 weitergegeben.",(count(_nearGroup)),typeOf _vehicle],1] call zero_fnc_msg;
}; if(_unit isEqualTo "vehicle") then { { _uid = getPlayerUID _x; _owners = _vehicle getVariable "zero_var_vehicle_owners"; _index = [_uid,_owners] call zero_fnc_findIndex; if(_index isEqualTo -1) then { _owners pushBack [_uid,_x getVariable["zero_var_realname",name _x]]; _vehicle setVariable["zero_var_vehicle_owners",_owners,true]; }; if(player != _x && {!isObjectHidden _x}) then {[[_vehicle,_x,profileName],"zero_fnc_clientGetKey",_x] call zero_fnc_sendPacket;}; }forEach (crew(vehicle player)); [format["Du hast deine Schlüssel an %1 Personen im Fahrzeug für das Fahrzeug %2 weitergegeben.",((count(crew(vehicle player)))-1),typeOf _vehicle],1] call zero_fnc_msg; } else { _unit = call compile format["%1", _unit]; _uid = getPlayerUID _unit; _owners = _vehicle getVariable "zero_var_vehicle_owners"; _index = [_uid,_owners] call zero_fnc_findIndex; if(_index isEqualTo -1) then { _owners pushBack [_uid,_unit getVariable["zero_var_realname",name _unit]]; _vehicle setVariable["zero_var_vehicle_owners",_owners,true]; }; [format["Du hast deine Schlüssel weitergegeben an %1 für das Fahrzeug %2",_unit getVariable["zero_var_realname",name _unit],typeOf _vehicle],1] call zero_fnc_msg; [[_vehicle,_unit,profileName],"zero_fnc_clientGetKey",_unit] call zero_fnc_sendPacket; };
