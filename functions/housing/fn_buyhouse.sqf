if (!hasInterface) exitWith {}; private["_house","_uid","_action","_houseCfg","_marker","_houseName","_numOfDoors"]; _house = param[0,objNull,[objNull]]; _uid = getPlayerUID player; if(isNull _house || !(_house isKindOf "House_F")) exitWith {}; uiSleep random(2.0); if((_house getVariable["zero_var_house_owned",false])) exitWith {"Das Haus ist bereits verkauft!" call zero_fnc_msg;}; if(!isNil {(_house getVariable "zero_var_house_sold")}) exitWith {(localize "STR_House_Sell_Process") call zero_fnc_msg;}; if(!zero_var_license_civ_home) exitWith { (localize "STR_House_License") call zero_fnc_msg;}; private _maxHouses = 1; if(zero_var_donator > 1) then { _maxHouses = 2;}; if(count zero_var_houses >= _maxHouses) exitWith {(format[localize "STR_House_Max_House",_maxHouses]) call zero_fnc_msg;}; if((player distance (getMarkerPos "Gang_Eroberung_1")) < 1500) exitWith {"Aufgrund der Nähe zur Gangeroberung ist dieses Haus, aus Sicherheitsgründen, nicht kaufbar" call zero_fnc_msg;}; if((player distance (getMarkerPos "chop_shop_name")) < 55 || (player distance (getMarkerPos "Dealer_4")) < 25 || (player distance (getMarkerPos "blaster")) < 100 || (player distance (getMarkerPos "Kontrolle 1_1_1")) < 200) exitWith {"Das Haus ist nicht kaufbar!" call zero_fnc_msg;}; closeDialog 0; _houseCfg = [(typeOf _house)] call zero_fnc_houseConfig; if(_houseCfg isEqualTo []) exitWith {}; if(([2, 0] call zero_fnc_Z0Check) < (_houseCfg select 0)) exitWith {(format [localize "STR_House_NotEnough", (_houseCfg select 0) call zero_fnc_numberText]) call zero_fnc_msg;}; _action = [ format["Dieses Haus kostet <t color='#8cff9b'>%1 €</t>. Willst du es kaufen?", [(_houseCfg select 0)] call zero_fnc_numberText],"Haus kaufen",localize "STR_Global_Buy",localize "STR_Global_Cancel" ] call BIS_fnc_guiMessage;
if(_action) then { if((_house getVariable["zero_var_house_owned",false])) exitWith {"Das Haus ist bereits verkauft!" call zero_fnc_msg;}; uiSleep random(1.5); if((_house getVariable["zero_var_house_owned",false])) exitWith {"Das Haus ist bereits verkauft!" call zero_fnc_msg;}; _house setVariable["zero_var_house_owned", true, true]; [[_uid,_house],"zero_fnc_addHouse",zero_var_HC1_owner,false] call zero_fnc_sendPacket; _house setVariable["zero_var_house_owner",[_uid,profileName],true]; _house setVariable["zero_var_locked",true,true]; _house setVariable["uid",round(random 99999),true]; [0, ([2, 0] call zero_fnc_Z0Check) - (_houseCfg select 0)] call zero_fnc_Z0Check; zero_var_vehicles pushBack _house; zero_var_houses pushBack [str(getPosATL _house),[]]; _marker = createMarkerLocal [format["house_%1",(_house getVariable "uid")],getPosATL _house]; _houseName = getText(configFile >> "CfgVehicles" >> (typeOf _house) >> "displayName"); _marker setMarkerTextLocal _houseName; _marker setMarkerColorLocal "ColorBlue"; _marker setMarkerTypeLocal "loc_Lighthouse"; _numOfDoors = getNumber(configFile >> "CfgVehicles" >> (typeOf _house) >> "numberOfDoors"); for "_i" from 1 to _numOfDoors do { _house setVariable[format["bis_disabled_Door_%1",_i],1,true]; }; [] call zero_fnc_updateRequest; ["Du hast das Haus erfolgreich gekauft!",1] call zero_fnc_msg; [format ["HOUSE BUY: %1 (%2, %3) hat ein Haus fuer %4 gekauft. Position %5", player getVariable["zero_var_realname",name player], getPlayerUID player, playerSide, [(_houseCfg select 0)] call zero_fnc_numberText, getPosATL _house]] call zero_fnc_zoLog; };
