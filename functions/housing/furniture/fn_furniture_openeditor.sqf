if (!hasInterface) exitWith {}; disableSerialization; params [["_house",objNull]]; if(!isNil 'zero_var_allowedToPlaceFurniture' && {serverTime - zero_var_allowedToPlaceFurniture < 120}) exitWith {"Du kannst nur alle 2min den Editor benutzen" call zero_fnc_msg;}; if(isNil 'zero_var_allowedToPlaceFurniture') then {zero_var_allowedToPlaceFurniture = serverTime;}; zero_var_allowedToPlaceFurniture = serverTime; if(zero_var_donator isEqualTo 0) then {["Als Premiumpack Besitzer kannst du bis zu 80 Objekte platzieren!",1,"Wusstest du schon?"] call zero_fnc_msg;}; if (!isNull (findDisplay 175462)) exitWith {}; createDialog "zero_var_furnitureDialog"; private _display = findDisplay 175462; private _pW = pixelW * 5 * (getResolution select 0) / 1920; private _pH = pixelH * 5 * (getResolution select 1) / 1080; private _backGroundColor = [0.3,0.3,0.3,0.8]; private _itemGrpSizeW = 60 * _pW; private _promptGrpSizeW = 100 * _pW; private _promptGrpSizeH = 50 * _pH; private _editSelectionGrpSizeW = 35 * _pW; private _editSelectionGrpSizeH = 20 * _pH; private _infoGrpSizeW = 70 * _pW; private _infoGrpSizeH = 80 * _pH; private _makeStructuredText = { params [["_grp",controlNull],["_idc",-1],["_position",[0,0,0,0]],["_text",""],["_font","PuristaMedium"],["_size",0.8],["_align","left"],["_color","#FFFFFF"],["_shadow","0"],["_colorBack",[0,0,0,0]]]; private _noGrp = (typeName _grp == typeName 0); if (!_noGrp && {isNull _grp}) exitWith {}; if (isNil "_display") exitWith {}; if (isNull _display) exitWith {}; _size = _size * (0.55 / (getResolution select 5)); private _ctrl = if (_noGrp) then { _display ctrlCreate ["RscStructuredText", _idc]; } else { _display ctrlCreate ["RscStructuredText", _idc, _grp]; }; _ctrl ctrlSetPosition _position; if (typeName _text == typeName "") then { _ctrl ctrlSetStructuredText (parseText format ["<t shadow='%6' font='%5' align='%4' size='%2' color='%3'>%1</t>", _text,_size,_color, _align,_font,_shadow]); }; if (typeName _text == typeName []) then { private _multiLineText = parseText ""; { _multiLineText = composeText [_multiLineText, (parseText format ["<t shadow='%6' font='%5' align='%4' size='%2' color='%3'>%1</t>", _x,_size,_color, _align,_font,_shadow]), lineBreak]; } forEach _text; _ctrl ctrlSetStructuredText _multiLineText; }; if (typeName _text == typeName (parseText "")) then { _ctrl ctrlSetStructuredText _text; }; _ctrl setVariable ["format",[_size,_color, _align,_font,_shadow]]; _ctrl ctrlSetBackgroundColor _colorBack; _ctrl ctrlEnable false; _ctrl ctrlCommit 0; _ctrl; }; private _makeButton = { params [["_grp",controlNull],["_idc",-1],["_position",[0,0,0,0]],["_text",""],["_action",""],["_font","PuristaLight"],["_size",0.7],["_textColor",[1,1,1,1]]]; private _noGrp = (typeName _grp == typeName 0); if (!_noGrp && {isNull _grp}) exitWith {}; if (isNil "_display") exitWith {}; if (isNull _display) exitWith {}; private _ctrl = if (_noGrp) then { _display ctrlCreate ["RscButton", _idc]; } else { _display ctrlCreate ["RscButton", _idc, _grp]; }; _ctrl ctrlSetPosition _position; _ctrl ctrlSetTextColor _textColor; _ctrl ctrlSetText _text; _ctrl ctrlSetFont _font; _ctrl ctrlSetFontHeight (0.034 * _size * (1 / (getResolution select 5))); _ctrl ctrlEnable true; _ctrl buttonSetAction format["if(!isNil 'zero_var_allowedToRefresh' && {serverTime - zero_var_allowedToRefresh < 0.1}) exitWith {};zero_var_allowedToRefresh = serverTime; %1",_action]; _ctrl ctrlCommit 0; _ctrl; }; private _makePicture = { params [["_grp",controlNull],["_idc",-1],["_position",[0,0,0,0]],["_picture",""],["_keepAspect", false],["_enable",false],["_color",[1,1,1,1]],["_tooltip",""]]; private _noGrp = (typeName _grp == typeName 0); if (!_noGrp && {isNull _grp}) exitWith {}; if (isNil "_display") exitWith {}; if (isNull _display) exitWith {}; private _rsc = if _keepAspect then {"RscPictureKeepAspect"} else {"RscPicture"}; private _ctrl = if (_noGrp) then { _display ctrlCreate [_rsc, _idc]; } else { _display ctrlCreate [_rsc, _idc, _grp]; }; _ctrl ctrlSetPosition _position; _ctrl ctrlSetText _picture; _ctrl ctrlSetTextColor _color; _ctrl ctrlEnable _enable; _ctrl ctrlSetTooltip _tooltip; _ctrl ctrlCommit 0; _ctrl; }; private _makeBackground = { params [["_grp",controlNull],["_idc",-1],["_position",[0,0,0,0]],["_color",[1,1,1,1]],["_enable",false],["_tooltip",""]]; private _noGrp = (typeName _grp == typeName 0); if (!_noGrp && {isNull _grp}) exitWith {}; if (isNil "_display") exitWith {}; if (isNull _display) exitWith {}; private _ctrl = if (_noGrp) then { _display ctrlCreate ["RscBackground", _idc]; } else { _display ctrlCreate ["RscBackground", _idc, _grp]; }; _ctrl ctrlSetPosition _position; _ctrl ctrlSetBackgroundColor _color; _ctrl ctrlEnable _enable; _ctrl ctrlSetTooltip _tooltip; _ctrl ctrlCommit 0; _ctrl; }; _display displayAddEventHandler ["unload", { {_x enableCollisionWith player;} forEach ((findDisplay 175462) getVariable ["zero_var_editorObjects",[]]); removeMissionEventHandler ["draw3D", ((_this select 0) getVariable ["zero_var_drawHandle",-1])]; private _cam = (_this select 0) getVariable ["zero_var_cam",objNull]; _cam cameraEffect ["terminate","back"]; [_cam] call zero_fnc_deleteVehicle; private _obj = (_this select 0) getVariable ["zero_var_curObj",objNull]; if (!isNull _obj) then {[_obj] call zero_fnc_deleteVehicle;}; setObjectViewDistance ((_this select 0) getVariable ["zero_var_viewDistance",[800,50]]); setViewDistance (((_this select 0) getVariable ["zero_var_viewDistance",[800,50]]) select 0); { _x hideObject false; true; } count (player nearEntities ["Man", 250]); }]; _display displayAddEventHandler ["mouseButtonDown", {_args = ["mouseButtonDown"]; _args append _this; _args pushBack true; _args call zero_fnc_furniture_handler}]; _display displayAddEventHandler ["mouseButtonUp", {_args = ["mouseButtonUp"]; _args append _this; _args pushBack true; _args call zero_fnc_furniture_handler}]; _display displayAddEventHandler ["mouseMoving", {_args = ["mouse"]; _args append _this; _args pushBack true; _args call zero_fnc_furniture_handler}]; _display displayAddEventHandler ["mouseHolding", {_args = ["mouse"]; _args append _this; _args pushBack false; _args call zero_fnc_furniture_handler}]; _display displayAddEventHandler ["keyDown", {_args = ["keyDown"]; _args append _this; _args call zero_fnc_furniture_handler}]; _display displayAddEventHandler ["keyUp", {_args = ["keyUp"]; _args append _this; _args call zero_fnc_furniture_handler}]; _display displayAddEventHandler ["mouseZChanged", {_args = ["mouseZChanged"]; _args append _this; _args call zero_fnc_furniture_handler}]; _display setVariable ["zero_var_drawHandle",(addMissionEventHandler ["draw3D", {0 call zero_fnc_furniture_draw}])]; _display setVariable ["zero_var_camSpeed",0.05]; _display setVariable ["zero_var_camMaxDistance",if(zero_var_donator > 0) then {30}else{15}]; _display setVariable ["zero_var_camHKeys",[false,false,false,false,false,false,false,false]]; _display setVariable ["zero_var_camMoveAllowed",false]; _display setVariable ["zero_var_house",_house]; _display setVariable ["zero_var_curObj",objNull]; _display setVariable ["zero_var_curTarget",objNull]; _display setVariable ["zero_var_curSelection",objNull]; _display setVariable ["zero_var_curDir",0]; _display setVariable ["zero_var_busy",false]; _display setVariable ["zero_var_camRotating",false]; _display setVariable ["zero_var_placementLegit",true]; _display setVariable ["zero_var_unsavedChanges",false]; _display setVariable ["zero_var_promtActive",false]; _display setVariable ["zero_var_limit",20]; _display setVariable ["zero_var_viewDistance",getObjectViewDistance]; setObjectViewDistance 30; setViewDistance 200; { if(_x != player) then { _x hideObject true; }; true; } count (player nearEntities ["Man", 250]); private _editorObjects = []; ["editor",_house,_editorObjects] call zero_fnc_furniture_allocate; _display setVariable ["zero_var_editorObjects",_editorObjects]; private _camPos = (positionCameraToWorld [0,0,-0.2]);
private _cam = "camera" camCreate _camPos; showCinemaBorder false; _cam cameraEffect ["internal","back"]; _cam camSetDir (getCameraViewDirection player); _cam camSetPos _camPos; _cam camSetFocus [3,0]; _cam camCommit 0; _display setVariable ["zero_var_cam",_cam]; _camPos = [(player getRelPos [1, 140]) select 0,(player getRelPos [1, 140]) select 1,((getPosATL player) select 2) + (2.3)]; private _camTarget = [(player getRelPos [2, 0]) select 0,(player getRelPos [2, 0]) select 1,((getPosATL player) select 2) + (0.3)]; private _motionRelDir = _camPos vectorFromTo _camTarget; _cam camSetPos _camPos; _cam camSetDir _motionRelDir; _cam camCommit 0; waitUntil {(if (isNil {camCommitted _cam}) then {true} else {camCommitted _cam})}; if (isNull _display) exitWith {}; private _mainGrp = _display ctrlCreate ["RscControlsGroupNoScrollbars",100]; _mainGrp ctrlSetPosition [safeZoneX,safeZoneY,safeZoneW,safeZoneH]; _mainGrp ctrlEnable false; _mainGrp ctrlSetFade 1; _mainGrp ctrlCommit 0; [0,50,[-10,-10,20*_pW,20*_pH],"Resources\Textures\Icons
ot_allowed.paa",false,false,[1,1,1,0.8]] call _makePicture; [_mainGrp,-1,[0,0,_itemGrpSizeW,safeZoneH],_backGroundColor] call _makeBackground; private _itemsGrp = _display ctrlCreate ["RscControlsGroupNoScrollbars",200,_mainGrp]; _itemsGrp ctrlSetPosition [0,0,_itemGrpSizeW,safeZoneH]; _itemsGrp ctrlCommit 0; private _promptGrp = _display ctrlCreate ["RscControlsGroupNoScrollbars",300,_mainGrp]; _promptGrp ctrlSetPosition [-10,-10,_promptGrpSizeW,_promptGrpSizeH]; _promptGrp ctrlCommit 0; [_promptGrp,-1,[0,0,_promptGrpSizeW,_promptGrpSizeH],_backGroundColor] call _makeBackground; [_promptGrp,301,[(_promptGrpSizeW*0.05),(_promptGrpSizeH*0.9)-(8*_pH),40*_pW,8*_pH],localize "STR_House_furniture_saveAndExit","[true] spawn zero_fnc_furniture_saveRequest;"] call _makeButton; [_promptGrp,302,[(_promptGrpSizeW*0.95)-(40*_pW),(_promptGrpSizeH*0.9)-(8*_pH),40*_pW,8*_pH], localize "STR_House_furniture_cancel",'{((findDisplay 175462) displayCtrl _x) ctrlEnable true} forEach [200,400,500];((findDisplay 175462) displayCtrl 300) ctrlSetPosition [-10,-10];((findDisplay 175462) displayCtrl 300) ctrlEnable false;((findDisplay 175462) displayCtrl 300) ctrlCommit 0;(findDisplay 175462) setVariable ["zero_var_camMoveAllowed",true];(findDisplay 175462) setVariable ["zero_var_promtActive",false];'] call _makeButton; [_promptGrp,303,[(_promptGrpSizeW*0.05),(_promptGrpSizeH*0.1),(_promptGrpSizeW*0.9),(_promptGrpSizeH*0.7)],[localize "STR_House_furniture_saveWarning_1","",localize "STR_House_furniture_saveWarning_2"]] call _makeStructuredText; private _editSelectionGrp = _display ctrlCreate ["RscControlsGroupNoScrollbars",400,_mainGrp]; _editSelectionGrp ctrlSetPosition [-10,-10,_editSelectionGrpSizeW,_editSelectionGrpSizeH]; _editSelectionGrp ctrlCommit 0; [_editSelectionGrp,-1,[0,0,_editSelectionGrpSizeW,_editSelectionGrpSizeH],_backGroundColor] call _makeBackground; [_editSelectionGrp,401,[(_editSelectionGrpSizeW*0.1),(_editSelectionGrpSizeH*0.1),(_editSelectionGrpSizeW*0.8),8*_pH],localize "STR_House_furniture_moveObject",'_curSel = (findDisplay 175462) getVariable ["zero_var_curSelection",objNull];if (!isNull _curSel) then {_vItem = configname (missionConfigFile >> "zero_Furniture" >> "furnitureItems" >> ("frn_" + typeOf _curSel));if ([true,_vItem,1] call zero_fnc_handleZOInv) then {private _editorObject = (findDisplay 175462) getVariable ["zero_var_editorObjects",objNull];(findDisplay 175462) setVariable ["zero_var_curObj",_curSel];(findDisplay 175462) setVariable ["zero_var_curSelection",objNull];_editorObject deleteAt (_editorObject find _curSel);(findDisplay 175462) setVariable ["zero_var_unsavedChanges",true];} else {[localize "STR_House_furniture_noVSpave","err"] spawn zero_fnc_furniture_msg};};'] call _makeButton; [_editSelectionGrp,402,[(_editSelectionGrpSizeW*0.1),(_editSelectionGrpSizeH*0.1)+(9*_pH),(_editSelectionGrpSizeW*0.8),8*_pH],localize "STR_House_furniture_pickupObject",'_curSel = (findDisplay 175462) getVariable ["zero_var_curSelection",objNull];if (!isNull _curSel) then {_vItem = configname (missionConfigFile >> "zero_Furniture" >> "furnitureItems" >> ("frn_" + typeOf _curSel));if ([true,_vItem,1] call zero_fnc_handleZOInv) then {private _editorObject = (findDisplay 175462) getVariable ["zero_var_editorObjects",[]];(findDisplay 175462) setVariable ["zero_var_curObj",objNull];(findDisplay 175462) setVariable ["zero_var_curSelection",objNull];_editorObject deleteAt (_editorObject find _curSel);[_curSel] call zero_fnc_deleteVehicle;[false] spawn zero_fnc_furniture_fillItems;(findDisplay 175462) setVariable ["zero_var_unsavedChanges",true];} else {[localize "STR_House_furniture_noVSpave","err"] spawn zero_fnc_furniture_msg;};};'] call _makeButton; private _infoGrp = _display ctrlCreate ["RscControlsGroupNoScrollbars",500,_mainGrp]; _infoGrp ctrlSetPosition [_itemGrpSizeW,safeZoneH-_infoGrpSizeH,_infoGrpSizeW,_infoGrpSizeH]; _infoGrp ctrlCommit 0; [_infoGrp,-1,[0,0,_infoGrpSizeW,_infoGrpSizeH],_backGroundColor] call _makeBackground; [_infoGrp,507,[(_infoGrpSizeW*0.83),(_infoGrpSizeH*0),(_infoGrpSizeW*0.15),(_infoGrpSizeH*0.05)],"\/", "0 spawn zero_fnc_furniture_toggleInfo;"] call _makeButton; [_infoGrp,501,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+(0*_pH),(_infoGrpSizeW*0.60),(5*_pH)],localize "STR_House_furniture_curWeight","PuristaMedium",0.9,"right","#FFFFFF"] call _makeStructuredText; [_infoGrp,502,[(_infoGrpSizeW*0.65),(_infoGrpSizeH*0.05)+(0*_pH),(_infoGrpSizeW*0.30),(5*_pH)],"","PuristaSemiBold",0.9,"center","#FFFFFF"] call _makeStructuredText; [_infoGrp,503,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+(5*_pH),(_infoGrpSizeW*0.60),(5*_pH)],localize "STR_House_furniture_objLimit","PuristaMedium",0.9,"right","#FFFFFF"] call _makeStructuredText; [_infoGrp,504,[(_infoGrpSizeW*0.65),(_infoGrpSizeH*0.05)+(5*_pH),(_infoGrpSizeW*0.30),(5*_pH)],"","PuristaSemiBold",0.9,"center","#FFFFFF"] call _makeStructuredText; [_infoGrp,505,[(_infoGrpSizeW*0.15),(_infoGrpSizeH*0.05)+(10*_pH),(_infoGrpSizeW*0.7),(6*_pH)], localize "STR_House_furniture_raiseLimit","0 spawn zero_fnc_furniture_raiseLimit;"] call _makeButton; [_infoGrp,506,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+(18*_pH),(_infoGrpSizeW*0.9),(9*_pH)], localize "STR_House_furniture_saveAndExit","[true] spawn zero_fnc_furniture_saveRequest;"] call _makeButton; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*0+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_W","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*1+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_S","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*2+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_A","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*3+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_F","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*4+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_Q","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*5+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_Z","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*6+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_HRMB","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*7+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_LMB","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*8+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_WHEEL","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; [_infoGrp,-1,[(_infoGrpSizeW*0.05),(_infoGrpSizeH*0.05)+((4*9+30)*_pH),(_infoGrpSizeW*0.95),4*_pH],localize "STR_House_furniture_but_WHEEL_shift","PuristaMedium",0.8,"left","#FFFFFF"] call _makeStructuredText; _mainGrp ctrlSetFade 0; _mainGrp ctrlEnable true; _mainGrp ctrlCommit 0.15; _display setVariable ["zero_var_camMoveAllowed",true]; [true] spawn zero_fnc_furniture_fillItems;
