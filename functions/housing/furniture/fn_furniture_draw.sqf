if (!hasInterface) exitWith {}; if (isNull (findDisplay 175462)) exitWith {}; private _display = findDisplay 175462; private _house = (findDisplay 175462) getVariable ["zero_var_house",objNull]; private _curObj = (findDisplay 175462) getVariable ["zero_var_curObj",objNull]; private _curSelection = (findDisplay 175462) getVariable ["zero_var_curSelection",objNull]; private _editorObjects = (findDisplay 175462) getVariable ["zero_var_editorObjects",[]]; private _camMaxDistance = (findDisplay 175462) getVariable ["zero_var_camMaxDistance",0]; private _pW = pixelW * 5 * (getResolution select 0) / 1920; private _pH = pixelH * 5 * (getResolution select 1) / 1080; private _lineStart = AGLToASL positionCameraToWorld [0,0,0]; private _lineEnd = AGLToASL screenToWorld getMousePosition; _lineEnd = (_lineEnd vectorAdd (vectorNormalized (_lineEnd vectorDiff _lineStart))); private _bb = { private _bbx = [_this select 0 select 0, _this select 1 select 0]; private _bby = [_this select 0 select 1, _this select 1 select 1]; private _bbz = [_this select 0 select 2, _this select 1 select 2]; private _arr = []; 0 = { _y = _x; 0 = { _z = _x; 0 = { _arr pushBack (_curSelection modelToWorld [_x,_y,_z]); true; } count _bbx; true; } count _bbz; reverse _bbz; true; } count _bby; _arr pushBack (_arr select 0); _arr pushBack (_arr select 1); _arr }; private _contact = []; private _target = objNull; private _legit = false; private _ins = lineIntersectsSurfaces [_lineStart, _lineEnd, player,_curObj,true,5,"VIEW","NONE"]; { if ((!isNull _curObj) && (count _contact == 0)) then { if !(((_x select 2) isKindOf "Man") || {(_x select 2) isKindOf "LandVehicle"} || {(_x select 2) isKindOf "Air"} || {(_x select 2) isKindOf "Sea"}) exitWith { _contact = (_x select 0); if ((((_x select 1) select 0) < 0.1) && {((_x select 1) select 1) < 0.1} && {((_x select 1) select 2) > 0.9}) then { if (!isNull (_x select 2) && {(((getModelInfo (_x select 2)) select 0) find "pavement") == -1}) then { _legit = true; }; if (isNull (_x select 2)) then { _legit = true;
}; }; }; }; if ((isNull _curObj) && (isNull _target)) then { if ((_x select 2) in _editorObjects) then { _target = (_x select 2); }; }; } forEach _ins; if (!isNull _curObj) then { if ((count _contact == 3) && {isOnRoad (ASLToAGL getPosASL _curObj)}) then { _legit = false; }; [_curObj, (if (count _contact == 0) then {[0,0,0]} else {_contact})] call zero_fnc_setPosASL; if ((_curObj distance _house) > _camMaxDistance) then {_legit = false;}; if (!_legit) then { ((findDisplay 175462) displayCtrl 50) ctrlSetPosition [(getMousePosition select 0) - (10*_pW),(getMousePosition select 1) - (10*_pH)]; } else { ((findDisplay 175462) displayCtrl 50) ctrlSetPosition [-10,-10]; }; ((findDisplay 175462) displayCtrl 50) ctrlCommit 0; } else { ((findDisplay 175462) displayCtrl 50) ctrlSetPosition [-10,-10]; ((findDisplay 175462) displayCtrl 50) ctrlCommit 0; }; _display setVariable ["zero_var_placementLegit",_legit]; if ((isNull _curObj) && (!isNull _target)) then { (findDisplay 175462) setVariable ["zero_var_curTarget",_target]; } else { (findDisplay 175462) setVariable ["zero_var_curTarget",objNull]; }; if (!isNull _curSelection) then { private _bbxr = boundingBoxReal _curSelection; private _points = _bbxr call _bb; for "_i" from 0 to 7 step 2 do { drawLine3D [ _points select _i, _points select (_i + 2), [0,1,0,1] ]; drawLine3D [ _points select (_i + 2), _points select (_i + 3), [0,1,0,1] ]; drawLine3D [ _points select (_i + 3), _points select (_i + 1), [0,1,0,1] ]; }; private _scrnPos = (worldToScreen ((((_curSelection modelToWorld (_bbxr select 1)) vectorDiff (_curSelection modelToWorld (_bbxr select 0))) vectorMultiply 0.5) vectorAdd (_curSelection modelToWorld (_bbxr select 0)))); if (count _scrnPos != 0) then { _scrnPos set [0, (safeZoneX*-1)+(_scrnPos select 0)]; _scrnPos set [1, (safeZoneY*-1)+(_scrnPos select 1)]; } else { _scrnPos = [-10,-10]; }; ((findDisplay 175462) displayCtrl 400) ctrlSetPosition _scrnPos; ((findDisplay 175462) displayCtrl 400) ctrlCommit 0; } else { ((findDisplay 175462) displayCtrl 400) ctrlSetPosition [-10,-10]; ((findDisplay 175462) displayCtrl 400) ctrlCommit 0; };
