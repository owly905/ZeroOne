if (!hasInterface) exitWith {}; waitUntil {!isNil "zero_var_HC1_owner"}; private ["_gangID","_exit","_gang","_id","_gruender","_member","_index","_data","_rang","_name","_maxmember","_bank","_house","_tag","_group","_handle","_convert"]; _gangID = param[0,"",["",[]]]; _convert = param[1,false,[false]]; if(_gangID isEqualTo "") exitWith {(format ["Es ist ein Fehler aufgetreten. %1",_gangID]) call zero_fnc_msg;}; _exit = false; if(_convert) then { [[clientOwner,_gangID],"zero_fnc_getGangname",zero_var_HC1_owner,false] call zero_fnc_sendPacket; waitUntil {!isNil "zero_var_gangReturn"}; if(zero_var_gangReturn isEqualTo []) exitWith {_exit = true;}; if(count _gangID > 1) then { private _action = [ parseText format["In welcher Gang mÃ¶chtest du als %1 spielen?",if(playerSide isEqualTo civilian)then{"Zivilist"}else{"Rebell"}], "Gangauswahl", format["%1",zero_var_gangReturn select 0], format["%1",zero_var_gangReturn select 1] ] call BIS_fnc_guiMessage; _gangID = if(_action) then {(_gangID select 0) select 0}else{(_gangID select 1) select 0}; }else{ _gangID = (_gangID select 0) select 0; }; zero_var_gangReturn = nil; [[clientOwner,8,[_gangID, getPlayerUID player, playerSide]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; }; if(_exit) exitWith {}; { _gang = _x getVariable["zero_var_gang",[]]; if (!(_gang isEqualTo [])) then { _id = _gang select 0; if(_gangID == _id) then { _group = _x; _exit = true; }; }; if(_exit) exitWith {}; } forEach allGroups; if (_exit) exitWith { _exit = false; _gang = _group getVariable["zero_var_gang",[]]; if(_gang isEqualTo []) exitWith {}; _gruender = _gang select 2; if(_gruender == (getPlayerUID player)) then { _handle = _group spawn {[player] joinSilent _this}; waitUntil {scriptDone _handle}; player setRank "COLONEL"; _group selectLeader player; _member = _gang select 3; _index = [getPlayerUID player, _member] call zero_fnc_findIndex; if (_index != -1) then { _data = _member select _index; if(count _data != 3) then { _data pushBack (player getVariable["zero_var_realname",name player]); _member set[_index,_data]; [[clientOwner,0,[_gang select 0,_member]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; (group player) setVariable["zero_var_gang",[_gang select 0,_gang select 1,_gang select 2,_member,_gang select 4,_gang select 5,_gang select 6,""],true]; }else{ if((_data select 2) != (player getVariable["zero_var_realname",name player])) then { _data set[2,(player getVariable["zero_var_realname",name player])]; _member set[_index,_data]; [[clientOwner,0,[_gang select 0,_member]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; (group player) setVariable["zero_var_gang",[_gang select 0,_gang select 1,_gang select 2,_member,_gang select 4,_gang select 5,_gang select 6,""],true]; }; }; }; }else{ _member = _gang select 3; _index = [getPlayerUID player, _member] call zero_fnc_findIndex; if (_index isEqualTo -1) then { _exit = true; }else{ _handle = _group spawn {[player] joinSilent _this}; waitUntil {scriptDone _handle}; _data = _member select _index; _rang = _data select 1; switch (_rang) do { case 1: {player setRank "CORPORAL";}; case 2: {player setRank "SERGEANT";}; case 3: {player setRank "LIEUTENANT";}; case 4: {player setRank "CAPTAIN";}; case 5: {player setRank "MAJOR";}; case 6: {player setRank "COLONEL";}; default {player setRank "PRIVATE";
}; }; if(count _data != 3) then { _data pushBack (player getVariable["zero_var_realname",name player]); _member set[_index,_data]; [[clientOwner,0,[_gang select 0,_member]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; (group player) setVariable["zero_var_gang",[_gang select 0,_gang select 1,_gang select 2,_member,_gang select 4,_gang select 5,_gang select 6,""],true]; }else{ if((_data select 2) != (player getVariable["zero_var_realname",name player])) then { _data set[2,(player getVariable["zero_var_realname",name player])]; _member set[_index,_data]; [[clientOwner,0,[_gang select 0,_member]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; (group player) setVariable["zero_var_gang",[_gang select 0,_gang select 1,_gang select 2,_member,_gang select 4,_gang select 5,_gang select 6,""],true]; }; }; }; }; if(_exit) then { zero_var_gang_kicked = true; }else{ [_group] call zero_fnc_gangHauptquatierInit; if(_group getVariable["zero_var_gangAnnounce",false] && !(zero_gang_flag getVariable["zero_var_gangFightEnded",false])) then { if(zero_gang_flag getVariable["zero_var_gangFight",-1] > 0) then { [((10*60)-(serverTime - (zero_gang_flag getVariable "zero_var_gangFight")))/60] spawn zero_fnc_gangEroberungTimer; }else{ [((10*60)-(serverTime - ((zero_gang_flag getVariable "zero_var_gangAnnounce") select 0)))/60,true] spawn zero_fnc_gangEroberungTimer; }; }; }; }; [[clientOwner,_gangID,getPlayerUID player],"zero_fnc_initGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; waitUntil {!isNil "zero_var_gangReturn"}; if(zero_var_gangReturn isEqualTo [] || count zero_var_gangReturn != 7) exitWith { zero_var_gangReturn = nil; zero_var_gang_kicked = true; }; _handle = [] spawn {[player] joinSilent grpNull;}; _name = zero_var_gangReturn select 0; _gruender = zero_var_gangReturn select 1; _member = zero_var_gangReturn select 2; _maxmember = zero_var_gangReturn select 3; _bank = zero_var_gangReturn select 4; _bank = parseNumber(_bank); _house = zero_var_gangReturn select 5; zero_var_gangReturn = nil; waitUntil {scriptDone _handle}; _index = [getPlayerUID player, _member] call zero_fnc_findIndex; if (_index != -1) then { _data = _member select _index; if(count _data != 3) then { _data pushBack (player getVariable["zero_var_realname",name player]); _member set[_index,_data]; [[clientOwner,0,[_gangID,_member]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; }else{ if((_data select 2) != (player getVariable["zero_var_realname",name player])) then { _data set[2,(player getVariable["zero_var_realname",name player])]; _member set[_index,_data]; [[clientOwner,0,[_gangID,_member]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; }; }; }; (group player) setVariable["zero_var_gang",[_gangID,_name,_gruender,_member,_maxmember,_bank,_house,""],true]; [(group player)] call zero_fnc_gangHauptquatierInit; if(zero_gang_flag getVariable["zero_var_gangControl","-1"] isEqualTo _gangID) then { zero_gang_flag setVariable["zero_var_gangControlGroup",(group player), true]; "Gang_Eroberung_1" setMarkerText format ["Gang Eroberung - %1",_name]; }; if((group player) getVariable["zero_var_gangAnnounce",false] && !(zero_gang_flag getVariable["zero_var_gangFightEnded",false])) then { if(zero_gang_flag getVariable["zero_var_gangFight",-1] > 0) then { [((15*60)-(serverTime - (zero_gang_flag getVariable "zero_var_gangFight")))/60] spawn zero_fnc_gangEroberungTimer; }else{ [((10*60)-(serverTime - ((zero_gang_flag getVariable "zero_var_gangAnnounce") select 0)))/60,true] spawn zero_fnc_gangEroberungTimer; }; };
