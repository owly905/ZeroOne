if (!hasInterface) exitWith {}; private["_gangPlayerList","_player","_group","_gang","_display","_titel","_text","_unten","_ok","_rang","_member","_index","_fehler","_chrByte","_allowed","_ownRang"]; disableSerialization; _display = findDisplay 3400; if (isNull _display) exitWith {}; _gangPlayerList = _display displayCtrl 3405; if(lbCurSel _gangPlayerList == -1) exitWith {"Du hast niemand ausgewählt!" call zero_fnc_msg;}; _player = _gangPlayerList lbData (lbCurSel _gangPlayerList); if(_player isEqualTo "") exitWith {"Es ist ein Fehler aufgetreten" call zero_fnc_msg;}; _group = (group player); _gang = _group getVariable ["zero_var_gang",[]]; if(count _gang < 7) exitWith {"Es ist ein Fehler aufgetreten" call zero_fnc_msg;}; _player = call compile _player; if (isNull _player) exitWith {"Niemanden ausgewählt" call zero_fnc_msg;}; if(getPlayerUID _player == (_gang select 2)) exitWith {"Den Owner kannst du nicht bearbeiten!" call zero_fnc_msg;}; _index = [getPlayerUID player, _gang select 3] call zero_fnc_findIndex; _ownRang = (((_gang select 3) select _index) select 1); createDialog "zero_var_gangerstellen"; _display = findDisplay 3200; if (isNull _display) exitWith {}; _titel = _display displayCtrl 3202; _text = _display displayCtrl 3201; _unten = _display displayCtrl 3204; _ok = _display displayCtrl 3203; _ok ctrlSetText "Bestätigen"; _ok buttonSetAction "zero_var_gangWeiter = true;"; _titel ctrlSetStructuredText parseText format["<t align='center' size='1'>Bitte gib den gewünschten Rang für %1 ein.</t>",_player getVariable["zero_var_realname",name _player]]; _unten ctrlSetStructuredText parseText format["<t align='center' size='0.95'>Rang 0 nichts, Rang 1 Mitgliederverwaltung, Rang 2 Konto benutzen<br/>Rang 3 Kontoverwaltung, Rang 4 Hauptquartierverwaltung<br/>Rang 5 Name ändern, Rang 6 Gang auflösen</t>"]; _rang = ""; while {true} do { _fehler = nil; _text ctrlSetText "";
_rang = ""; zero_var_gangWeiter = false; waitUntil {zero_var_gangWeiter || isNull (findDisplay 3200)}; zero_var_gangWeiter = nil; if (isNull (findDisplay 3200)) exitWith {}; _rang = ctrlText _text; if (_rang isEqualTo "") then { _fehler = true; _unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#DC143C'>Das Eingabefeld ist leer.</t>"]; }else { if ((parseNumber _rang) > 6) then { _fehler = true; _unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#DC143C'>Der Rang darf höchstens 6 sein.</t>"]; }else{ if((parseNumber _rang) isEqualTo 6 && (getPlayerUID player != (_gang select 2))) then { _fehler = true; _unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#DC143C'>Rang 6 darf nur der Owner der Gang vergeben!</t>"]; }else{ if(parseNumber _rang > _ownRang) then { _fehler = true; _unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#DC143C'>Der Rang darf nicht höher als dein eigener sein!</t>"]; }else{ _chrByte = toArray (_rang); _allowed = toArray("0123456"); { if !(_x in _allowed) exitWith { _fehler = true; _unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#DC143C'>Das Zeichen %1 ist im Rang nicht erlaubt!</t>",toString [_x]]; } }forEach _chrByte; }; }; }; }; if (isNil "_fehler") exitWith{}; }; if (isNull (findDisplay 3200)) exitWith {}; _rang = parseNumber(_rang); _member = _gang select 3; _index = [str(_player),zero_var_gangMemberChangeRank] call zero_fnc_findIndex; if(_index != -1) then { zero_var_gangMemberChangeRank set[_index, [str(_player),_rang]]; }else{ zero_var_gangMemberChangeRank pushBack [str(_player),_rang]; }; _gangPlayerList lbDelete (lbCurSel _gangPlayerList); _gangPlayerList lbAdd format ["%1 [%2]", _player getVariable["zero_var_realname",name _player],_rang]; _gangPlayerList lbSetData [(lbSize _gangPlayerList)-1,str(_player)]; _gangPlayerList lbSetColor [(lbSize _gangPlayerList)-1, [0, 1, 0, 1]]; lbSort _gangPlayerList; closeDialog 0;
