if (!hasInterface) exitWith {}; private["_group","_gang","_konto","_display","_titel","_player","_ok","_fehler","_betrag","_number","_chrByte","_allowed","_text","_unten"]; disableSerialization; if(((group player) getVariable["zero_var_gangKontoInUse",objNull]) != player) exitWith {"Jemand anderes greift auf das Gangkonto zu!" call zero_fnc_msg;}; _group = (group player); _gang = _group getVariable ["zero_var_gang",[]]; if(_gang isEqualTo []) exitWith {"Du bist in keiner Gang" call zero_fnc_msg;}; if(count _gang < 7) exitWith {"Es ist ein Fehler aufgetreten" call zero_fnc_msg;}; _konto = _gang select 5; _player = lbData[3302,(lbCurSel 3302)]; if(_player isEqualTo "") exitWith {"Niemanden ausgewählt" call zero_fnc_msg;}; _player = call compile _player; if (isNull _player) exitWith {"Niemanden ausgewählt" call zero_fnc_msg;}; createDialog "zero_var_gangerstellen"; _display = findDisplay 3200; if (isNull _display) exitWith {}; _titel = _display displayCtrl 3202; _text = _display displayCtrl 3201; _unten = _display displayCtrl 3204; _ok = _display displayCtrl 3203; _ok ctrlSetText "Überweisen"; _ok buttonSetAction "zero_var_gangWeiter = true;"; _titel ctrlSetStructuredText parseText format["<t align='center' size='1'>Bitte gib den gewünschten Betrag ein,<br/>den du an %1 überweisen möchten.</t>",_player getVariable["zero_var_realname",name _player]]; _unten ctrlSetStructuredText parseText format["<t align='center' size='1'>Sie dürfen maximal 999.999€ überweisen!</t>"]; while {true} do { _fehler = nil; _text ctrlSetText ""; _betrag = ""; zero_var_gangWeiter = false; waitUntil {zero_var_gangWeiter || isNull (findDisplay 3200)}; zero_var_gangWeiter = nil; if (isNull (findDisplay 3200)) exitWith {}; _betrag = ctrlText _text; if (_betrag isEqualTo "") then { _fehler = true; _unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#DC143C'>Das Eingabefeld ist leer.</t>"]; }else { if ((count _betrag) > 6) then { _fehler = true;
_unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#DC143C'>Sie dürfen maximal 999.999€ überweisen.</t>"]; }else{ _chrByte = toArray (_betrag); _allowed = toArray("0123456789"); { if !(_x in _allowed) exitWith { _fehler = true; _unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#DC143C'>Das Zeichen %1 ist nicht erlaubt!</t>",toString [_x]]; } }forEach _chrByte; _number = parseNumber(_betrag); iF(_konto < _number) then { _fehler = true; _unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#DC143C'>So viel Geld hat deine Gang nicht! Es fehlen %1€</t>",[_number - _konto] call zero_fnc_numberText]; }; }; }; if (isNil "_fehler") then { _number = parseNumber(_betrag); _unten ctrlSetStructuredText parseText format["<t align='center' size='1' color='#EDF5F5'>Der Betrag %1€ wird überprüft!</t>",[_number] call zero_fnc_numberText]; _gang set[5,_konto - _number]; _group setVariable["zero_var_gang",_gang,true]; [[clientOwner,1,[_gang select 0,_gang select 5]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; _display = findDisplay 3300; _titel = _display displayCtrl 3301; _titel ctrlSetStructuredText parseText format["<t align='left' size='1.3'>Aktuell aktive Mitglieder:</t><t align='right' size='1.3'>%1€</t>",[_konto - _number] call zero_fnc_numberText]; closeDialog 0; uiSleep 0.5; [[_number,format["Die Gang %1",_gang select 1],getPlayerUID player],"zero_fnc_transferMoney",_player] call zero_fnc_sendPacket; uiSleep 0.5; [format["Der Betrag %1 wurde an %2 überwiesen!",[_number] call zero_fnc_numberText, _player getVariable["zero_var_realname", name _player]],1] call zero_fnc_msg; [format ["GANG TRANSFER: %1 (%2, %3) hat %4 vom Gangkonto der Gang %5 erhalten. Vorher %6, nachher %7", player getVariable["zero_var_realname", name player],getPlayerUID player, playerSide,[_number] call zero_fnc_numberText, _gang select 1,[_konto] call zero_fnc_numberText,[_konto - _number] call zero_fnc_numberText]] call zero_fnc_zoLog; }; }; [] spawn zero_fnc_gangUpdateGanginfo;
