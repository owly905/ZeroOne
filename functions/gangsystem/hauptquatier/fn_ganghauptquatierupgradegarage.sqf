if (!hasInterface) exitWith {}; private["_group","_gang","_gangHouse","_gangHousePos","_price","_title","_ui","_progressBar","_titleText","_exit","_mode","_gangKonto","_house","_distance","_gangHouseUpgrades"]; disableSerialization; _group = (group player); _gang = _group getVariable ["zero_var_gang",[]]; if(_gang isEqualTo []) exitWith {"Du bist in keiner Gang" call zero_fnc_msg;}; if(count _gang < 7) exitWith {"Es ist ein Fehler aufgetreten" call zero_fnc_msg;}; _gangKonto = _gang select 5; _gangHouse = _gang select 6; _gangHousePos = _gangHouse select 0; if(_gangHousePos isEqualTo []) exitWith {"Es ist kein Ganghauptquartier eingetragen" call zero_fnc_msg;}; _house = nearestBuilding _gangHousePos; _distance = round(player distance _house); if(_distance > 30) exitWith {"Du bist zu weit vom Ganghauptquartier entfernt!" call zero_fnc_msg;}; (group player) setVariable["zero_var_gangHausInUse",player,true]; _price = param[0,50000000,[0]]; _mode = param[1,false,[false]]; uiSleep 0.5; ["Dabei gilt, dass dieser höchstens <t color='#FF0000'>20m</t> vom Haus entfernt sein darf!<br/>
				Der Pfeil gibt die Fahrtrichtung des Fahrzeugs an.<br/>
				Enter-Taste speichert die Positionierung<br/>
				ESC bricht die Aktion ab",1,"Du erhälst nun die Möglichkeit den Spawnpunkt für die Fahrzeuge der Garage festzulegen"] call zero_fnc_msg; (group player) setVariable["zero_var_gangHausInUse",player,true]; zero_var_gangArrow = ["Sign_Arrow_Direction_F",(getPos player)] call zero_fnc_createVehicleLocal; zero_var_gangArrow enableSimulation false; [zero_var_gangArrow, [0.1,1.1,0.3]] call zero_fnc_attachToLocal; zero_var_gangSpawn = [getPos zero_var_gangArrow, getDir zero_var_gangArrow]; zero_var_gangKey = (findDisplay 46) displayAddEventHandler ["KeyDown", { if((_this select 1) == 28) then {zero_var_gangKeyPressed = true;}; if((_this select 1) == 1) then {zero_var_gangKeyPressed = false;}; }]; _title = "Entfernung"; 5 cutRsc ["zero_var_progress","PLAIN"]; _ui = uiNamespace getVariable "zero_var_progress"; _progressBar = _ui displayCtrl 38201; _titleText = _ui displayCtrl 38202;
_titleText ctrlSetText format["%1 %2m",_title,_distance]; _progressBar progressSetPosition (_distance/20); while {true} do { if(!alive player || _distance > 30) exitWith {_exit = true;}; if(!isNil "zero_var_gangKeyPressed") exitWith {}; if(_distance <= 20) then {_titleText ctrlSetTextColor [0,1,0,1]}; if(_distance > 20) then {_titleText ctrlSetTextColor [1,0,0,1]}; _distance = round(player distance _house); _progressBar progressSetPosition (_distance/20); _titleText ctrlSetText format["%1 %2m",_title,_distance]; zero_var_gangSpawn = [getPos zero_var_gangArrow, getDir zero_var_gangArrow]; uiSleep 0.2; }; 5 cutText ["","PLAIN"]; (group player) setVariable["zero_var_gangHausInUse",nil,true]; [zero_var_gangArrow] call zero_fnc_deleteVehicle; (findDisplay 46) displayRemoveEventHandler ["KeyDown",zero_var_gangKey]; if(!isNil "zero_var_gangKeyPressed" && {!zero_var_gangKeyPressed}) exitWith {zero_var_gangKeyPressed = nil; "Du hast die Positionierung abgebrochen!" call zero_fnc_msg;}; zero_var_gangKeyPressed = nil; if(_group != (group player) || !isNil "_exit" || _distance > 20) exitWith {"Du warst zu weit entfernt!" call zero_fnc_msg;}; _gang = (group player) getVariable ["zero_var_gang",[]]; _gangHouse = _gang select 6; if(_mode) then { _gangHouse set[2,zero_var_gangSpawn]; ["Der Spawnpunkt wurde erfolgreich verschoben!",1] call zero_fnc_msg; }else{ _gangKonto = _gang select 5; if(_gangKonto < _price) exitWith { _exit = true; (format ["Deine Gang hat nicht genug Geld auf dem Konto. Es fehlen %1€", [_price - _gangKonto] call zero_fnc_numberText]) call zero_fnc_msg; }; _gangKonto = _gangKonto - _price; _gang set[5,_gangKonto]; _gangHouse pushBack zero_var_gangSpawn; _gangHouseUpgrades = _gangHouse select 1; _gangHouseUpgrades pushBack "Garage"; _gangHouse set[1,_gangHouseUpgrades]; ["Das Hauptquatier wurde erfolgreich um eine Garage erweitert",1] call zero_fnc_msg; }; zero_var_gangSpawn = nil; if(!isNil "_exit") exitWith {}; _gang set[6,_gangHouse]; _group setVariable["zero_var_gang",_gang,true]; [[clientOwner,5,[_gang select 0,_gangHouse,_gang select 5]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; [] spawn zero_fnc_gangUpdateGanginfo;
