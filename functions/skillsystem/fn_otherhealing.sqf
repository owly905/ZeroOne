params["_mode","_injured"]; if (!hasInterface) exitWith {}; private["_newDamage","_exit","_move","_pos"]; if(zero_var_action_inUse) exitWith {}; if(isNull _injured) exitWith {}; _exit = false; if(playerSide != independent) then { if(_mode == 0) then{ if(!([false,"medipack",1] call zero_fnc_handleZOInv)) exitWith {_exit = true; "Du brauchst ein Erste-Hilfe Kasten" call zero_fnc_msg;}; }else{ if(!([false,"medipack_large",1] call zero_fnc_handleZOInv)) exitWith {_exit = true; "Du brauchst ein Erste-Hilfe Kasten" call zero_fnc_msg;}; }; }; if(_exit) exitWith {}; _pos = getPos _injured; zero_var_action_inUse = true; _move = "ainvpknlmstpslaywpstdnon_medicother"; player playMove _move; waitUntil {animationState player == _move || zero_var_killed || (vehicle player) != player}; _exit = false; if((_mode isEqualTo 1) && (playerSide != independent))then{ disableSerialization; 5 cutRsc ["zero_var_progress","PLAIN"]; _ui = uiNamespace getVariable "zero_var_progress"; _progress = _ui displayCtrl 38201; _pgText = _ui displayCtrl 38202; _pgText ctrlSetText format["Benutze Medipack (1%1)...","%"]; _progress progressSetPosition 0.01; _cP = 0; _cP2 = 1/50; for "_i" from 0 to 50 step 1 do { if(animationState player != _move ) then { player playMove _move; player playActionNow "stop"; player playMove _move; player playActionNow "stop"; player playMove _move; }; uiSleep 1; _cP = _cP + _cP2; _progress progressSetPosition _cP;
_pgText ctrlSetText format["Benutze Medipack (%1%2)...",round(_cP * 100),"%"]; if(_cP >= 1) exitWith {}; if(zero_var_killed) exitWith {_exit = true;}; if(zero_var_istazed) exitWith {_exit = true;}; if((_pos distance player) > 10) exitWith {_exit = true;}; if(!(isNull objectParent player)) exitWith {_exit = true;}; if(player getVariable["zero_var_restrained",false]) exitWith {_exit = true;}; if(!([false,"medipack_large",1] call zero_fnc_handleZOInv)) exitWith {_exit = true;}; }; 5 cutText ["","PLAIN"]; player playActionNow "stop"; }else{ uiSleep 6; }; if(!isNull (objectParent player) || !alive _injured || (_pos distance player) > 10 || zero_var_killed || _exit) exitWith {zero_var_action_inUse = false;}; _newDamage = ["selfhealing"] call zero_fnc_getSkillValueCharacter; if(playerSide isEqualTo independent || _mode isEqualTo 1 || zero_var_buff_healing) then { [[player, "zero_var_fnc_setDamage", [_injured, 0]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; } else { if((damage _injured) > _newDamage) then { [[player, "zero_var_fnc_setDamage", [_injured, _newDamage]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; } else { [[player, "zero_var_fnc_setDamage", [_injured, 0]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; }; }; ["selfhealing"] call zero_fnc_improveSkillCharacter; uiSleep 1.5; player switchMove "amovpknlmstpsnonwnondnon"; [[], "zero_fnc_hudUpdate", _injured] call zero_fnc_sendPacket; zero_var_action_inUse = false;
