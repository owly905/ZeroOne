if (!hasInterface) exitWith {}; private["_type","_index","_price","_amount","_mode","_amountInv","_name","_oldAmount"]; _mode = param[0,0,[0]]; if((lbCurSel 2402) isEqualTo -1) exitWith {}; _isSpecialGangDealer = (findDisplay 2400) getVariable ["zero_var_display_specialdealer",false]; _type = lbData[2402,(lbCurSel 2402)]; _index = -1; if(isNil "zero_var_market_prices") then { _index = getNumber(missionConfigFile >> "zero_CfgItems" >> _type >> "sellPrice"); }else{ _index = [_type,zero_var_market_prices] call zero_fnc_findIndex; }; if(_index isEqualTo -1) exitWith {"Es wurde kein Preis gefunden." call zero_fnc_msg;}; if(zero_var_shop_type == "dangernuclear") exitWith {"Das kannst du hier nicht verkaufen" call zero_fnc_msg;}; _price = -1; if(isNil "zero_var_market_prices") then { _price = _index; }else{ _price = (zero_var_market_prices select _index) select 1; }; if(_price isEqualTo -1) exitWith {}; _amount = -1; if(_mode isEqualTo 0) then { _amount = ctrlText 2405; if(!([_amount] call zero_fnc_isNumber)) exitWith {(localize "STR_Shop_Virt_NoNum") call zero_fnc_msg;}; _amount = parseNumber (_amount); }else{ _index = [_type, zero_var_inventory] call zero_fnc_findIndex; if(_index isEqualTo -1) exitWith {_amount = 99999;}; _amount = (zero_var_inventory select _index) select 1; }; _index = [_type, zero_var_inventory] call zero_fnc_findIndex; if(_index isEqualTo -1) exitWith {(localize "STR_Shop_Virt_NotEnough") call zero_fnc_msg;}; _amountInv = (zero_var_inventory select _index) select 1; if(_amount > _amountInv) exitWith {(localize "STR_Shop_Virt_NotEnough") call zero_fnc_msg;}; _price = (_price * _amount); if (_isSpecialGangDealer) then { _price = _price * 1.2; }; _name = getText(missionConfigFile >> "zero_CfgItems" >> _type >> "name"); if(([false,_type,_amount] call zero_fnc_handleZOInv)) then { [format[localize "STR_Shop_Virt_SellItem",_amount,_name,[_price] call zero_fnc_numberText],1] call zero_fnc_msg;
[1, ([3, 0] call zero_fnc_Z0Check) + _price] call zero_fnc_Z0Check; [] call zero_fnc_virt_update; if (_type == "goldbar") then { [format ["ITEM SELL: %1 (%2, %3) hat %4 %5 fuer insgesamt %6 verkauft",player getVariable["zero_var_realname",name player], getPlayerUID player, playerSide, _amount, getText(missionConfigFile >> "zero_CfgItems" >> _type >> "name"),[_price] call zero_fnc_numberText]] call zero_fnc_zoLog; }; if(_type in ["apple","bananen","brief","cement","clothing","cocainep","copper_r","diamondc","dunklematerie","glass","heroinp","helium3", "iron_r","marijuana","moonshine","oilp","paket","peach","petroleum","salt_r","tuna","turtle","wine", "reinforced_concrete","copper_conductor","danger","dangernuclear"] && (playerSide isEqualTo civilian || playerSide isEqualTo opfor)) then { if(isNil "zero_marketChange") then { [] spawn { uiSleep 30 + random(5); [[zero_marketChange],"zero_fnc_marketChange",zero_var_HC1_owner,false] call zero_fnc_sendPacket; private _tmpText = ""; private _price = 0; { private _index = [(_x select 0),zero_var_market_prices] call zero_fnc_findIndex; _price = _price + (((zero_var_market_prices select _index) select 1) * (_x select 1)); _tmpText = format ["%1(%2 %3)%4", _tmpText, (_x select 1), getText(missionConfigFile >> "zero_CfgItems" >> (_x select 0) >> "name"),if(_forEachIndex isEqualTo ((count zero_marketChange)-1)) then {""}else{","}]; } forEach zero_marketChange; [format ["ITEM SELL: %1 (%2, %3) hat %4 fuer insgesamt %5 verkauft",player getVariable["zero_var_realname",name player], getPlayerUID player, playerSide, _tmpText,[_price] call zero_fnc_numberText]] call zero_fnc_zoLog; zero_marketChange = nil; }; zero_marketChange = [[_type, _amount]]; }else{ _index = [_type,zero_marketChange] call zero_fnc_findIndex; if(_index != -1) then { _oldAmount = (zero_marketChange select _index) select 1; zero_marketChange set[_index,[_type, _amount + _oldAmount]]; }else{ zero_marketChange pushBack [_type, _amount]; }; }; }; };
