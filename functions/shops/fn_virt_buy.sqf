if (!hasInterface) exitWith {}; private["_type","_price","_amount","_diff","_name","_gangKaufen","_gang","_exit"]; if((lbCurSel 2401) isEqualTo -1) exitWith {(localize "STR_Shop_Virt_Nothing") call zero_fnc_msg;}; _gangKaufen = param[0,false,[false]]; _type = lbData[2401,(lbCurSel 2401)]; _price = lbValue[2401,(lbCurSel 2401)]; if((playerSide isEqualTo west || playerSide isEqualTo independent) && (_type in ["redgull","lockpick","fuelF"])) then {_price = 2000;}; _amount = ctrlText 2404; if(!([_amount] call zero_fnc_isNumber)) exitWith {(localize "STR_Shop_Virt_NoNum") call zero_fnc_msg;}; _amount = parseNumber(_amount); if(_type == "adrenalin" && zero_var_adrenalin > 0) exitWith {"Du hast bereits eine Adrenalin-Spritze dabei!" call zero_fnc_msg;}; if(_type == "adrenalin") then {_amount = 1;}; _diff = [_type,_amount,zero_var_carryWeight,zero_var_maxWeight] call zero_fnc_calWeightDiff; if(_diff <= 0) exitWith {(localize "STR_NOTF_NoSpace") call zero_fnc_msg;}; _amount = _diff; _price = (_price * _amount); _exit = false; _gang = (group player) getVariable["zero_var_gang",[]]; if(_gangKaufen) then { if(_gang isEqualTo []) exitWith {"Du bist in keiner Gang!" call zero_fnc_msg;_exit = true;}; if((_gang select 5) < _price) then { (format["Deine Gang hat nicht genug Geld um das Item zu kaufen.<br/><br/>Es fehlen: €%1",[_price - (_gang select 5)] call zero_fnc_numberText]) call zero_fnc_msg;_exit = true;}; }else{ if(_price > ([3, 0] call zero_fnc_Z0Check)) then {(localize "STR_NOTF_NotEnoughMoney") call zero_fnc_msg; _exit = true;}; }; if(_exit) exitWith {}; _name = getText(missionConfigFile >> "zero_CfgItems" >> _type >> "name");
if(([true,_type,_amount] call zero_fnc_handleZOInv)) then { if(_gangKaufen) then { if((_gang select 5) < _price) then { (format["Deine Gang hat nicht genug Geld um das Item zu kaufen.<br/><br/>Es fehlen: €%1",[_price - (_gang select 5)] call zero_fnc_numberText]) call zero_fnc_msg; [false,_type,_amount] call zero_fnc_handleZOInv; _exit = true; }else{ [format ["GANG BUY: %1 (%2, %3) hat %4 %5 fuer %6 Euro gekauft.", player getVariable["zero_var_realname",name player], getPlayerUID player, playerSide, _amount, _name, [_price] call zero_fnc_numberText]] call zero_fnc_zoLog; _gang set[5,(_gang select 5) - _price]; ((group player) setVariable["zero_var_gang",_gang,true]); if(isNil "zero_var_gangKontoUpdate") then { zero_var_gangKontoUpdate = true; [] spawn { private _time = serverTime + 10; waitUntil {isNull (findDisplay 2400) || (serverTime >= _time)}; _gang = (group player) getVariable ["zero_var_gang",[]]; [[clientOwner,1,[_gang select 0,_gang select 5]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; zero_var_gangKontoUpdate = nil; }; }; }; }else{ if(_price > ([3, 0] call zero_fnc_Z0Check)) then { (localize "STR_NOTF_NotEnoughMoney") call zero_fnc_msg; [false,_type,_amount] call zero_fnc_handleZOInv; _exit = true; }else{ [1, ([3, 0] call zero_fnc_Z0Check) - _price] call zero_fnc_Z0Check; [format ["VIRT BUY: %1 (%2, %3) hat %4 %5 fuer %6 Euro gekauft.", player getVariable["zero_var_realname",name player], getPlayerUID player, playerSide, _amount, _name, [_price] call zero_fnc_numberText]] call zero_fnc_zoLog; }; }; if(_exit) exitWith {}; [format[localize "STR_Shop_Virt_BoughtItem",_amount,_name,[_price] call zero_fnc_numberText],1] call zero_fnc_msg; [] call zero_fnc_virt_update; };
