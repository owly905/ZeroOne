if (!hasInterface) exitWith {}; private["_price","_control","_menge","_selection","_data","_gangKaufen","_gang","_exit"]; _gangKaufen = param[0,false,[false]]; _control = (findDisplay 3100) displayCtrl 3102; _menge = lbCurSel ((findDisplay 3100) displayCtrl 3108); _selection = lbCurSel _control; if(_selection isEqualTo -1) exitWith { titleRsc ["zero_var_introtext","PLAIN"]; (((uiNamespace getVariable "zero_var_introdisplay") displayCtrl 5501) ctrlSetText localize "STR_Shop_NoClothes"); }; _price = (_control lbValue _selection); _data = (_control lbData _selection); _exit = false; _gang = (group player) getVariable["zero_var_gang",[]]; if(_gangKaufen) then { if(_gang isEqualTo []) exitWith { titleRsc ["introtext","PLAIN"]; (((uiNamespace getVariable "nok_introdisplay") displayCtrl 5501) ctrlSetText "Du bist in keiner Gang!"); _exit = true; }; if(!isNull ((group player) getVariable["zero_var_gangKontoInUse",objNull])) exitWith { _exit = true; "Auf das Gangkonto wird bereits zugegriffen!" call zero_fnc_msg; }; if((_gang select 5) < (_price * _menge)) then { titleRsc ["introtext","PLAIN"]; (((uiNamespace getVariable "nok_introdisplay") displayCtrl 5501) ctrlSetText localize "STR_Shop_NotEnoughClothesGang"); _exit = true; }; }else{ if((_price * _menge) > ([3, 0] call zero_fnc_Z0Check)) then { titleRsc ["introtext","PLAIN"]; (((uiNamespace getVariable "nok_introdisplay") displayCtrl 5501) ctrlSetText localize "STR_Shop_NotEnoughClothes"); _exit = true;}; }; if(_exit) exitWith {}; if(_data in ["ItemWatch","ItemMap","ItemGPS","ItemCompass","ToolKit","FirstAidKit","Binocular","NVGoggles","NVGoggles_INDEP","NVGoggles_OPFOR","Medikit","Rangefinder","B_UavTerminal"] || _data find "optic_" != -1 || _data find "muzzle_snds_" != -1) then { if(!(player canAdd _data)) exitWith {_exit = true;}; }; if(_exit) exitWith {(localize "STR_NOTF_NoRoom") call zero_fnc_msg;}; private _added = 0; for "_i" from 1 to _menge do { if(_gangKaufen) then { if((_gang select 5) < _price) then { titleRsc ["zero_var_introtext","PLAIN"]; (((uiNamespace getVariable "zero_var_introdisplay") displayCtrl 5501) ctrlSetText localize "STR_Shop_NotEnoughClothesGang");
_exit = true; }else{ _gang set[5,(_gang select 5) - _price]; ((group player) setVariable["zero_var_gang",_gang,true]); if(isNil "zero_var_gangKontoUpdate") then { zero_var_gangKontoUpdate = true; [(_price * _menge),_gang select 1] spawn { [format ["GANG BUY: %1 (%2, %3) Gang %4 hat fuer %5 Euro eingekauft.", player getVariable["zero_var_realname",name player], getPlayerUID player, playerSide, _this select 1, [_this select 0] call zero_fnc_numberText]] call zero_fnc_zoLog; private _time = serverTime + 10; waitUntil {isNull (findDisplay 3100) || (serverTime >= _time)}; _gang = (group player) getVariable ["zero_var_gang",[]]; [[clientOwner,1,[_gang select 0,_gang select 5]],"zero_fnc_updateGang",zero_var_HC1_owner,false] call zero_fnc_sendPacket; zero_var_gangKontoUpdate = nil; }; }; }; }else{ if(_price > ([3, 0] call zero_fnc_Z0Check)) then { titleRsc ["zero_var_introtext","PLAIN"]; (((uiNamespace getVariable "zero_var_introdisplay") displayCtrl 5501) ctrlSetText localize "STR_Shop_NotEnoughClothes"); _exit = true; }else{ [1, ([3, 0] call zero_fnc_Z0Check) - _price] call zero_fnc_Z0Check; }; }; if(_exit) exitWith {}; [_data,true] call zero_fnc_handleZOItem; _added = _added + 1; }; if (!_exit) then { private _weaponName = ""; if(isClass(configFile >> "CfgMagazines" >> _data)) then { _weaponName = getText(configFile >> "CfgMagazines" >> _data >> "displayName"); }else{ if (isClass (configFile >> "CfgWeapons" >> _data)) then { _weaponName = getText(configFile >> "CfgWeapons" >> _data >> "displayName"); }else{ if (isClass (configFile >> "CfgVehicles" >> _data)) then { _weaponName = getText(configFile >> "CfgVehicles" >> _data >> "displayName"); }else{ if (isClass (configFile >> "CfgGlasses" >> _data)) then { _weaponName = getText(configFile >> "CfgGlasses" >> _data >> "displayName"); }else{ _weaponName = _data; }; }; }; }; [format ["ITEM BUY: %1 (%2, %3) hat %4 %5 fuer %6 Euro gekauft.", player getVariable["zero_var_realname",name player], getPlayerUID player, playerSide, _added, _weaponName, [_added * _price] call zero_fnc_numberText]] call zero_fnc_zoLog; }; playSound "WeaponRestedOn"; [[_control,_selection]] call zero_fnc_shopchange;
