if (!hasInterface) exitWith {}; private["_vehicle","_vid","_price","_tmpArray","_action","_shopArr","_index","_shop"]; disableSerialization; if(!zero_var_allowedToSell) exitWith {"Du kannst ein Fahrzeug nur alle 20 Sekunden verkaufen" call zero_fnc_msg; closeDialog 0;}; if(zero_var_allowedToSell) then { zero_var_allowedToSell = false; [] spawn { uiSleep 20; zero_var_allowedToSell = true; }; }; _action = [ format["MÃ¶chtest du das Fahrzeug wirklich verkaufen?"], format["Fahrzeug verkaufen"], localize "STR_Global_Yes", localize "STR_Global_No" ] call BIS_fnc_guiMessage; if(!_action) exitWith {}; if(lbCurSel 2802 isEqualTo -1) exitWith {(localize "STR_Global_NoSelection") call zero_fnc_msg;}; _vehicle = lbData[2802,(lbCurSel 2802)]; _vehicle = (call compile format["%1",_vehicle]) select 0; _vid = lbValue[2802,(lbCurSel 2802)]; if(isNil "_vehicle") exitWith {(localize "STR_Garage_Selection_Error") call zero_fnc_msg;}; _price = getNumber(missionConfigFile >> "zero_CfgVehicles" >> _vehicle >> "garage_sell"); if(playerSide isEqualTo independent || playerSide isEqualTo west) then { _shop = format["%1_%2",if(playerSide isEqualTo west) then {"cop"}else{"feuerwehr"},toLower(zero_var_garage_type)]; _shopArr = (getArray(missionConfigFile >> "zero_VehicleShops" >> _shop >> "vehicles"));
_index = [_vehicle,_shopArr] call zero_fnc_findIndex; if(_index != -1) then { _price = round(((_shopArr select _index) select 1)/2); }else{ _price = 1000; }; }; [format ["GARAGE SELL: %1 (%2, %3) hat %4 fuer %5 verkauft.", player getVariable["zero_var_realname", name player], getPlayerUID player, playerSide, getText(missionConfigFile >> "zero_CfgVehicles" >> _vehicle >> "logname"), _price]] call zero_fnc_zoLog; [[_vid,getPlayerUID player,_price,clientOwner,zero_var_garage_type],"zero_fnc_vehicleDelete",zero_var_HC1_owner,false] call zero_fnc_sendPacket; _tmpArray = []; if (zero_var_garage_type == "Car") then { { if (_x select 0 != _vid) then { _tmpArray pushBack _x; }; } forEach zero_var_carVehicles; zero_var_carVehicles = _tmpArray; [zero_var_carVehicles] spawn zero_fnc_impoundMenu; }; if (zero_var_garage_type == "Air") then { { if (_x select 0 != _vid) then { _tmpArray pushBack _x; }; } forEach zero_var_airVehicles; zero_var_airVehicles = _tmpArray; [zero_var_airVehicles] spawn zero_fnc_impoundMenu; }; if (zero_var_garage_type == "Ship") then { { if (_x select 0 != _vid) then { _tmpArray pushBack _x; }; } forEach zero_var_shipVehicles; zero_var_shipVehicles = _tmpArray; [zero_var_shipVehicles] spawn zero_fnc_impoundMenu; }; closeDialog 0;
