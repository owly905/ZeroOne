if (!hasInterface) exitWith {}; private["_display","_curState","_text","_className","_vehicles","_trunkSpace","_vehicle","_color","_multiplyer","_colorArray","_pos","_setValue","_airVehicles","_vindex","_baseprice","_vehicleinfo"]; disableSerialization; switch zero_var_vehicleShopCurrentStep do { case 1: { _display = findDisplay 2300; _text = "Fehler. Bitte komm spaeter nochmal vorbei!"; _curState = lbData[2309,lbCurSel 2309]; switch _curState do { case "car": { _text = "Autos sind ideal für Personentransport, mit ihnen ist man schnell und mobil!"; }; case "truck": { _text = "LKWs sind die Monster auf der Insel, sie sind groß und stabil, außerdem haben sie eine hohe Lagerkapazität. Aber vorsichtig, sie sind bevorzugte Beute von Rebelen und nicht besonders schnell."; }; case "air": { _text = "Luftfahrzeuge sind wahre Allzweckwaffen, mit ihnen ist mann schnell unterwegs, sie können eine hohe Anzahl an Personen transportieren und mit ihrer mittelgroßen Lagerkapazität kann man außerdem auch gut Farmen."; }; case "ship": { _text = "Schiffe sind die einzigen Fahrzeuge, mit denen man auf dem Wasser schnell mobil ist, ideal um das Naturschutzgebiet zu erforschen."; }; case "kart": { _text = "Ein Kart kann maximal 1 Person transportieren und hat eine sehr geringe Lagerkapazität, mit ihnen kann man lustige Rennen mit Freunden fahren."; }; }; (_display displayCtrl 2310) ctrlSetStructuredText parseText _text; zero_var_vehicleShopVehicleTypeIndex = lbCurSel 2309; }; case 2: { if(!(ctrlEnabled ((findDisplay 2300) displayCtrl 2309))) exitWith {}; ((findDisplay 2300) displayCtrl 2309) ctrlEnable false; { if( ( _x isKindOf "Car" ) || ( _x isKindOf "Air" ) || ( _x isKindOf "Ship" ) || ( _x isKindOf "Tank" ) || ( _x isKindOf "Submarine" ) ) then { for "_i" from 0 to ( count( getArray(configFile >> "CfgVehicles" >> ( typeOf _x ) >> "hiddenSelectionsTextures") ) - 1 ) do { _x setObjectMaterial [ _i,"A3\data_f\default.rvmat" ]; }; _x hideObject true; }; false; } count ( [ 24745, 18902.2, 0 ] nearObjects 30 ); _className = (lbData[2309,(lbCurSel 2309)]); _vIndex = (lbValue[2309,(lbCurSel 2309)]); _basePrice = (getArray(missionConfigFile >> "zero_VehicleShops" >> (zero_var_vehicleShopInfo select 0) >> "vehicles") select _vIndex) select 1; _vehicleInfo = [_className] call zero_fnc_fetchVehInfo; _trunkSpace = getNumber(missionConfigFile >> "zero_CfgVehicles" >> _className >> "trunk"); if(_trunkSpace == -1) then {_trunkSpace = "None";}; zero_var_vehicleShopVehicleMietpreis = _basePrice; zero_var_vehicleShopVehicleKaufpreis = round(_basePrice * 1.5); zero_var_vehicleShopVehicleVersicherungspreis = round(zero_var_vehicleShopVehicleKaufpreis*0.7); _display = findDisplay 2300; (_display displayCtrl 2307) ctrlSetStructuredText parseText "<t align='left'>Mietpreis: </t>"; (_display displayCtrl 2308) ctrlSetStructuredText parseText format["<t align='right' color='#8cff9b'>%1€</t>",[zero_var_vehicleShopVehicleMietpreis] call zero_fnc_numberText]; (_display displayCtrl 2314) ctrlSetStructuredText parseText "<t align='left'>Kaufpreis: </t>"; (_display displayCtrl 2315) ctrlSetStructuredText parseText format["<t align='right' color='#8cff9b'>%1€</t>",[zero_var_vehicleShopVehicleKaufpreis] call zero_fnc_numberText]; (_display displayCtrl 2310) ctrlShow true; ((_display displayCtrl 2310)) ctrlSetStructuredText parseText format[ "Fahrzeuginformationen: <br/>" + (localize "STR_Shop_Veh_UI_MaxSpeed") + " %1 km/h<br/>" + (localize "STR_Shop_Veh_UI_HPower") + " %2<br/>" + (localize "STR_Shop_Veh_UI_PSeats") + " %3<br/>" + (localize "STR_Shop_Veh_UI_Trunk") + " %4<br/>" + (localize "STR_Shop_Veh_UI_Fuel") + " %5<br/>" + (localize "STR_Shop_Veh_UI_Armor") + " %6<br/>" + "Moegliche Versicherungskosten: <t color='#8cff9b'>%7€</t>", _vehicleInfo select 8, _vehicleInfo select 11, if(_className == "O_Heli_Transport_04_bench_F") then {8}else{_vehicleInfo select 10}, _trunkSpace, _vehicleInfo select 12, _vehicleInfo select 9, [zero_var_vehicleShopVehicleVersicherungspreis] call zero_fnc_numberText ]; if!(_className in ["B_T_UAV_03_F","B_UAV_01_F"]) then { { if(_x select 0 == _className) then { _vehicle = _x select 1; }; } forEach zero_var_cachedVehicles; private _pos = [ 24745, 18902.2, 0 ]; _vehicle = [_className, _pos] call zero_fnc_createVehicleLocal; _vehicle allowDamage false; _vehicle enableSimulation false; _vehicle setPosATL _pos; [_vehicle, _pos] call zero_fnc_setPosATL; _colorArray = getArray(missionConfigFile >> "zero_CfgVehicles" >> _className >> "textures"); if(typeName _colorArray == typeName []) then { for "_i" from 0 to count(_colorArray)-1 do { if(((_colorArray select _i) select 1) == (zero_var_vehicleShopInfo select 2)) exitWith { _vehicle setObjectTexture [0, ((_colorArray select _i) select 2) select 0]; if((count ((_colorArray select _i) select 2)) >= 2) then { _vehicle setObjectTexture [1,((_colorArray select _i) select 2) select 1]; }; if((count ((_colorArray select _i) select 2)) >= 3) then { _vehicle setObjectTexture [2,((_colorArray select _i) select 2) select 2]; }; if((count ((_colorArray select _i) select 2)) >= 4) then { _vehicle setObjectTexture [3,((_colorArray select _i) select 2) select 3]; }; }; }; }; zero_var_vehicleShopVehicleObject = _vehicle; }else{ zero_var_vehicleShopVehicleObject = objNull; }; zero_var_vehicleShopVehicleClass = _className; zero_var_vehicleShopVehicleClassIndex = lbCurSel 2309; [] spawn { uiSleep 1; ((findDisplay 2300) displayCtrl 2309) ctrlEnable true; }; }; case 3: { if(!(ctrlEnabled ((findDisplay 2300) displayCtrl 2311))) exitWith {};
((findDisplay 2300) displayCtrl 2311) ctrlEnable false; _display = findDisplay 2300; (_display displayCtrl 2307) ctrlSetStructuredText parseText "<t align='left'>Mietpreis: </t>"; (_display displayCtrl 2308) ctrlSetStructuredText parseText format["<t align='right' color='#8cff9b'>%1€</t>",[zero_var_vehicleShopVehicleMietpreis] call zero_fnc_numberText]; (_display displayCtrl 2314) ctrlSetStructuredText parseText "<t align='left'>Kaufpreis: </t>"; (_display displayCtrl 2315) ctrlSetStructuredText parseText format["<t align='right' color='#8cff9b'>%1€</t>",[zero_var_vehicleShopVehicleKaufpreis] call zero_fnc_numberText]; if(lbData[2311,(lbCurSel 2311)] != "Default") then { _color = call compile format["%1", lbData[2311,(lbCurSel 2311)]]; }; if(isNil "_color" || zero_var_vehicleShopVehicleClass in ["B_T_UAV_03_F","B_UAV_01_F"]) then { _color = "Default"; } else { zero_var_vehicleShopVehicleObject setObjectTexture [0,(_color select 2) select 0]; if((count (_color select 2))>=2) then { zero_var_vehicleShopVehicleObject setObjectTexture [1,(_color select 2) select 1]; }; if((count (_color select 2))>=3) then { zero_var_vehicleShopVehicleObject setObjectTexture [2,(_color select 2) select 2]; }; if((count (_color select 2))>=4) then { zero_var_vehicleShopVehicleObject setObjectTexture [3,(_color select 2) select 3]; }; }; zero_var_vehicleShopVehicleSkinIndex = lbCurSel 2311; zero_var_vehicleShopVehicleSkinData = _color; [] spawn { uiSleep 0.1; ((findDisplay 2300) displayCtrl 2311) ctrlEnable true; }; }; case 4:{ if(!(ctrlEnabled ((findDisplay 2300) displayCtrl 2311))) exitWith {}; ((findDisplay 2300) displayCtrl 2311) ctrlEnable false; if((lbData[2311,(lbCurSel 2311)]) == "Default" || (lbData[2311,(lbCurSel 2311)]) == "disabled") then { _multiplyer = 1; } else { _multiplyer = getNumber(missionConfigFile >> "zero_CfgMaterials" >> (lbData[2311,(lbCurSel 2311)]) >> "value"); }; _display = findDisplay 2300; (_display displayCtrl 2307) ctrlSetStructuredText parseText "<t align='left'>Mietpreis: </t>"; (_display displayCtrl 2308) ctrlSetStructuredText parseText format["<t align='right' color='#8cff9b'>%1€</t>",[zero_var_vehicleShopVehicleMietpreis * _multiplyer] call zero_fnc_numberText]; (_display displayCtrl 2314) ctrlSetStructuredText parseText "<t align='left'>Kaufpreis: </t>"; (_display displayCtrl 2315) ctrlSetStructuredText parseText format["<t align='right' color='#8cff9b'>%1€</t>",[zero_var_vehicleShopVehicleKaufpreis * _multiplyer] call zero_fnc_numberText]; if((lbData[2311,(lbCurSel 2311)]) != "disabled" && (lbData[2311,(lbCurSel 2311)]) != "Default" && !(zero_var_vehicleShopVehicleClass in ["B_T_UAV_03_F","B_UAV_01_F"])) then { switch (zero_var_vehicleShopVehicleClass) do { case "C_Offroad_02_unarmed_F": { _setValue = [0]; }; case "B_T_LSV_01_armed_F": { _setValue = [0,1,3]; }; case "B_T_LSV_01_unarmed_F": { _setValue = [0,1,3]; }; case "O_T_LSV_02_unarmed_F": { _setValue = [0,1,3]; }; case "C_Plane_Civil_01_F": { _setValue = [0,1]; }; case "C_Offroad_01_F": { _setValue = [0]; }; case "B_G_Offroad_01_F": { _setValue = [0]; }; case "B_MRAP_01_F": { _setValue = [0]; }; case "I_MRAP_03_F": { _setValue = [0]; }; case "I_MRAP_03_F": { _setValue = [0]; }; default { _setValue = []; for "_i" from 0 to (count(getArray(configFile >> "CfgVehicles" >> zero_var_vehicleShopVehicleClass >> "hiddenSelectionsTextures")) -1) do { _setValue pushBack _i; }; }; }; { zero_var_vehicleShopVehicleObject setObjectMaterial [_x,getText(missionConfigFile >> "zero_CfgMaterials" >> (lbData[2311,(lbCurSel 2311)]) >> "path")]; } forEach _setValue; }; if((lbData[2311,(lbCurSel 2311)]) == "Default" && playerSide in [civilian, east] && !isNil "zero_var_vehicleShopFirstMaterial") then { for "_i" from 0 to (count(getArray(configFile >> "CfgVehicles" >> zero_var_vehicleShopVehicleClass >> "hiddenSelectionsTextures")) -1) do { zero_var_vehicleShopVehicleObject setObjectMaterial [_i,"A3\data_f\default.rvmat"]; }; } else { if((lbData[2311,(lbCurSel 2311)]) == "Default" && playerSide in [civilian, east] && (zero_var_vehicleShopVehicleObject isKindOf "Air")) then { for "_i" from 0 to (count(getArray(configFile >> "CfgVehicles" >> zero_var_vehicleShopVehicleClass >> "hiddenSelectionsTextures")) -1) do { zero_var_vehicleShopVehicleObject setObjectMaterial [_i,"A3\data_f\default.rvmat"]; }; }; }; if(getNumber(missionConfigFile >> "zero_CfgMaterials" >> (lbData[2311,(lbCurSel 2311)]) >> "donator") <= (zero_var_donator)) then { zero_var_vehicleShopVehicleMaterial = (lbData[2311,(lbCurSel 2311)]); zero_var_vehicleShopVehicleMaterialIndex = lbCurSel 2311; } else { zero_var_vehicleShopVehicleMaterial = "disabled"; zero_var_vehicleShopVehicleMaterialIndex = 0; }; if(lbCurSel 2311 != 0) then { zero_var_vehicleShopFirstMaterial = false; }; zero_var_vehicleShopVehicleMietpreisTemp = (zero_var_vehicleShopVehicleMietpreis * _multiplyer); zero_var_vehicleShopVehicleKaufpreisTemp = (zero_var_vehicleShopVehicleKaufpreis * _multiplyer); [] spawn { uiSleep 0.1; ((findDisplay 2300) displayCtrl 2311) ctrlEnable true; }; }; case 5:{ if(!(ctrlEnabled ((findDisplay 2300) displayCtrl 2311))) exitWith {}; ((findDisplay 2300) displayCtrl 2311) ctrlEnable false; zero_var_vehicleShopBuyType = (lbData[2309,(lbCurSel 2309)]); if((zero_var_vehicleShopBuyType) == "buyInsurance") then { ((findDisplay 2300) displayCtrl 2315) ctrlSetStructuredText parseText format["<t align='right' color='#8cff9b'>%1€</t>",[zero_var_vehicleShopVehicleKaufpreisTemp + zero_var_vehicleShopVehicleVersicherungspreis] call zero_fnc_numberText]; } else { ((findDisplay 2300) displayCtrl 2315) ctrlSetStructuredText parseText format["<t align='right' color='#8cff9b'>%1€</t>",[zero_var_vehicleShopVehicleKaufpreisTemp] call zero_fnc_numberText]; }; [] spawn { uiSleep 0.1; ((findDisplay 2300) displayCtrl 2311) ctrlEnable true; }; }; default { zero_var_Camrunning = false; }; };
