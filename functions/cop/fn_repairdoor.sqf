if (!hasInterface) exitWith {}; private ["_building","_doors","_door","_cP","_cpRate","_ui","_title","_titleText","_fed","_progressBar"]; _building = param[0,objNull,[objNull]]; if(isNull _building) exitWith {(localize "STR_ISTR_Bolt_NotNear") call zero_fnc_msg;}; if(!(_building isKindOf "House_F")) exitWith {(localize "STR_ISTR_Bolt_NotNear") call zero_fnc_msg;}; _doors = 1; while {true} do { if(!isClass(configFile >> "CfgVehicles" >> (typeOf _building) >> "AnimationSources" >> format["Door_%1_source",_doors])) exitWith {}; _doors = _doors + 1; }; _fed = false; _door = 0; switch (typeOf _building) do { case "Land_Research_HQ_F": {_cpRate = 0.005; _fed = true;}; default {_cpRate = 0.08;}; }; if(player distance (getMarkerPos "fed_reserve") < 20) then {_fed = true;}; for "_i" from 1 to _doors do { _selPos = _building selectionPosition format["Door_%1_trigger",_i]; _worldSpace = _building modelToWorld _selPos; if(player distance _worldSpace < 5) exitWith {_door = _i;}; }; if(_door isEqualTo 0) exitWith {(localize "STR_Cop_NotaDoor") call zero_fnc_msg;}; zero_var_action_inUse = true;
closeDialog 0; disableSerialization; _title = localize "STR_Cop_RepairingDoor"; 5 cutRsc ["zero_var_progress","PLAIN"]; _ui = uiNamespace getVariable "zero_var_progress"; _progressBar = _ui displayCtrl 38201; _titleText = _ui displayCtrl 38202; _titleText ctrlSetText format["%2 (1%1)...","%",_title]; _progressBar progressSetPosition 0.01; _cP = 0.01; while {true} do { uiSleep 0.26; if(isNull _ui) then { 5 cutRsc ["zero_var_progress","PLAIN"]; _ui = uiNamespace getVariable "zero_var_progress"; }; _cP = _cP + _cpRate; _progressBar progressSetPosition _cP; _titleText ctrlSetText format["%3 (%1%2)...",round(_cP * 100),"%",_title]; if(_cP >= 1 || !alive player) exitWith {}; if(zero_var_interrupted) exitWith {}; }; zero_var_action_inUse = false; 5 cutText ["","PLAIN"]; player playActionNow "stop"; if(!alive player) exitWith {zero_var_action_inUse = false;}; if(zero_var_interrupted) exitWith {zero_var_interrupted = false; titleText[localize "STR_NOTF_ActionCancel","PLAIN"]; zero_var_action_inUse = false;}; zero_var_action_inUse = false; _building setVariable[format["bis_disabled_Door_%1",_door],1,true]; _building animate [format["Door_%1_rot",_door],0];
