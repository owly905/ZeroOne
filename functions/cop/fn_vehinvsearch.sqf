if (!hasInterface) exitWith {}; private["_vehicle","_vehicleInfo","_value","_var","_val","_index","_inventar","_chance","_foundAmount","_vehicleWeight","_itemWeight","_illegalItems"]; _vehicle = param[0,objNull,[objNull]]; if(!isNil "zero_var_trunk_in_use") exitWith {}; if(isNull _vehicle) exitWith {}; if(!((_vehicle isKindOf "Air") || (_vehicle isKindOf "Ship") || (_vehicle isKindOf "LandVehicle"))) exitWith {}; if(!isNil{_vehicle getVariable "zero_var_searched"}) exitWith {"Das Fahrzeug wurde erst vor kurzem durchsucht. Warte 5 Minuten." call zero_fnc_msg;}; zero_var_trunk_in_use = true; [[0,_vehicle,player,[],clientOwner],"zero_fnc_trunk",zero_var_HC1_owner,false] call zero_fnc_sendPacket; ["Durchsuche...",-1] call zero_fnc_msg; waitUntil {!isNil "zero_var_sendtrunkre"}; zero_var_trunk_vehicle = zero_var_sendtrunkre; zero_var_sendtrunkre =nil; _vehicleInfo = zero_var_trunk_vehicle; if(_vehicleInfo isEqualTo []) exitWith {(localize "STR_Cop_VehEmpty") call zero_fnc_msg;}; if((typeName _vehicleInfo) isEqualTo (typeName "")) exitWith {(localize "STR_MISC_VehInvUse") call zero_fnc_msg;}; _inventar = (_vehicleInfo select 0); _chance = ["search"] call zero_fnc_getSkillValueCharacter; _value = 0; _foundAmount = 0; _vehicleWeight = 0; _itemWeight = 0; _illegalItems = getArray(missionConfigFile >> "zero_CfgItems" >> "illegalItems"); { _var = _x select 0; _val = _x select 1; _index = [_var,_illegalItems] call zero_fnc_findIndex;
if(_index != -1) then { _random = random(100); if(_random > _chance) then { _foundAmount = round(_val * 0.5); _inventar set[_forEachIndex,[_var,_val-_foundAmount]]; _itemWeight = (getNumber(missionConfigFile >> "zero_CfgItems" >> _var >> "weight")) * (_val-_foundAmount); }else{ _foundAmount = _val; _inventar set[_forEachIndex,[-1]]; _itemWeight = 0; }; _value = _value + (_foundAmount * ((_illegalItems select _index) select 1)); }else{ _itemWeight = (getNumber(missionConfigFile >> "zero_CfgItems" >> _var >> "weight")) * _val; }; _vehicleWeight = _vehicleWeight + _itemWeight; uiSleep 0.1; } forEach _inventar; _inventar = _inventar - [[-1]]; _vehicleInfo set[0,_inventar]; _vehicleInfo set[1,_vehicleWeight]; if(_value > 0) then { [[0,format[localize "STR_NOTF_VehContraband",[_value] call zero_fnc_numberText]],"zero_fnc_broadcast",(allPlayers - entities "HeadlessClient_F")] call zero_fnc_sendPacket; [0, ([2, 0] call zero_fnc_Z0Check) + _value] call zero_fnc_Z0Check; [format[localize "STR_NOTF_VehContraband",[_value] call zero_fnc_numberText],3] call zero_fnc_msg; }else{ [localize "STR_Cop_NoIllegalVeh",3] call zero_fnc_msg; }; [[1,_vehicle,player,_vehicleInfo,clientOwner],"zero_fnc_trunk",zero_var_HC1_owner,false] call zero_fnc_sendPacket; zero_var_trunk_in_use = nil; ["search"] call zero_fnc_improveSkillCharacter; [_vehicle] spawn { (_this select 0) setVariable["zero_var_searched",true,true]; uiSleep (5*60); (_this select 0) setVariable["zero_var_searched",nil,true]; };
