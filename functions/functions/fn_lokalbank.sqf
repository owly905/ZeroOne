if (!hasInterface) exitWith {}; private ["_shop","_price","_ui","_progress","_cP","_pos","_cops","_marker","_exit","_time","_action","_pgText","_serverTime"]; _shop = zero_var_interactionTarget; _time = _shop getVariable "zero_var_bank_robbed"; _exit = false; disableSerialization; if(serverTime <= 1500) exitWith {"Es ist noch zu früh am Tag, es ist kein Bargeld in den Tresoren." call zero_fnc_msg;}; if(!isNil "_time" && playerSide in [civilian,east]) then { if(serverTime - _time <= 3600)then{ _exit=true; (format["Die Bank wurde vor kurzen ausgeraubt und die nächste Bargeldlieferung wird erst in %1 Minuten erwartet.",round((3600 - (serverTime - _time)) / 60)]) call zero_fnc_msg; }; }; if(_exit)exitWith{}; if(playerSide in [west,independent]) exitWith { if(!isNil "_time") then { if(serverTime - _time <= 3600)then{ (format["Die nächste Bargeldlieferung wird erst in %1 Minuten erwartet.",round((3600 - (serverTime - _time)) / 60)]) call zero_fnc_msg; } else { "Die Bank wurde noch nicht ausgeraubt!" call zero_fnc_msg; }; }; }; if(zero_var_already_robbed) exitWith {"Du kannst nicht beide Banken gleichzeitg ausrauben :D" call zero_fnc_msg;}; if(player distance _shop > 10) exitWith {"Du bist zu weit entfernt!" call zero_fnc_msg;}; if(vehicle player != player) exitWith {"Du kannst die Bank nicht aus einem Auto ausrauben!" call zero_fnc_msg;}; if !(alive player) exitWith {}; if (currentWeapon player == "" || currentWeapon player == "Rangefinder" || currentWeapon player == "binocular") exitWith {"Wie willst du eine Bank ohne Waffe überfallen?" call zero_fnc_msg;}; _cops = {(side _x) isEqualTo west} count playableUnits; if(_cops < 10) exitWith {"Die Bank ist verriegelt, weil die Polizei sie nicht schützen kann !" call zero_fnc_msg;}; private _robber = _shop getVariable ["zero_var_bank_robber", ""]; private _inUse = false; private _uid = getPlayerUID player; if (!(_robber isEqualTo "") && {!(_robber isEqualTo _uid)} && {_robber call Zero_fnc_isUIDActive}) exitWith { "Es koennen nicht zwei Personen gleichzeitig eine Bank ausrauben" call zero_fnc_msg; }; _shop setVariable ["zero_var_bank_robber", _uid, true]; _price = 1500000 + round(random 1000000); _shop setVariable ["zero_var_bank_robbed",(serverTime + 350),true]; _shop setVariable["zero_var_interaction", "" ]; zero_var_already_robbed = true; ["Der Alarm wurde ausgelöst. Die Polizei ist auf dem Weg!",1] call zero_fnc_msg; [[1,format["ACHTUNG! - Eine Bank wird gerade ausgeraubt! Weitere Informationen auf der Karte!"]],"zero_fnc_broadcast",west] call zero_fnc_sendPacket; [11,getPlayerUID player,name player] call zero_fnc_wantedViaScript; _pos = position player; _serverTime = serverTime; [[player, "zero_var_fnc_createMarker", [format ["MarkerRob_%1",_serverTime], _pos]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; waitUntil {!isNil "zero_var_createMarkerResponse"}; _marker = zero_var_createMarkerResponse; zero_var_createMarkerResponse = nil; _marker setMarkerColor "ColorRed"; _marker setMarkerText "!ACHTUNG! Banküberfall !ACHTUNG!";
_marker setMarkerType "mil_warning"; 5 cutRsc ["zero_var_progress","PLAIN"]; _ui = uiNamespace getVariable "zero_var_progress"; _progress = _ui displayCtrl 38201; _pgText = _ui displayCtrl 38202; _pgText ctrlSetText format["Bleibe in einem Radius von 10m (1%1)...","%"]; _progress progressSetPosition 0.01; _cP = 0.0028; while{true} do { uiSleep 1; _cP = _cP + 0.0024; _progress progressSetPosition _cP; _pgText ctrlSetText format["Bleibe in einem Radius von 10m (%1%2)...",round(_cP * 100),"%"]; if !((_shop getVariable ["zero_var_bank_robber", ""]) isEqualTo _uid) exitWith {5 cutText ["","PLAIN"]; _exit = true; "Es koennen nicht zwei Personen gleichzeitig eine Bank ausrauben" call zero_fnc_msg;}; if(_cP >= 1) exitWith {5 cutText ["","PLAIN"];}; if(player distance _shop > 10.5) exitWith {5 cutText ["","PLAIN"]; _exit = true; "Du bist zu weit weg gelaufen. Ausrauben Abgebrochen" call zero_fnc_msg;}; if!(alive player) exitWith {5 cutText ["","PLAIN"]; _exit = true;}; if(player getVariable ["zero_var_restrained",false]) exitWith {5 cutText ["","PLAIN"]; _exit = true;}; }; deleteMarker format ["MarkerRob_%1",_serverTime]; _shop setVariable ["zero_var_bank_robber", nil, true]; if(!_exit) then { [format["Du hast %1€ gestohlen. Verschwinde, bevor die Polizei dich entdeckt! Du erhälst das Geld in 25 Minuten, da es erst von deinem Mittelsmann gewaschen werden muss. <br/><br/> Du solltest dich in der Zeit nicht an Bankautomaten blicken lassen ...",[_price] call zero_fnc_numberText],2] call zero_fnc_msg; if!(alive player) exitWith {}; zero_var_use_atm = false; uiSleep 1500; _shop addAction["Deutsche Bank ausrauben",zero_fnc_lokalbank,"",0,false,false,"",'player distance _target < 3 && {isNull (objectParent player)}']; _shop setVariable["zero_var_interaction","RobPrivateProperty"]; zero_var_use_atm = true; zero_var_already_robbed = false; if(zero_var_killed_lokalbank || zero_var_restrained_lokalbank) exitWith { "Du bist gestorben oder wurdest festgenommen und dein Mittelsmann hat das Geld lieber selbst eingesteckt." call zero_fnc_msg; zero_var_killed_lokalbank = false; systemChat "Deutsche Bank: Du bist gestorben und dein Mittelsmann hat das Geld lieber selbst eingesteckt."; }; if(!(player getVariable ["zero_var_restrained",false]) && !zero_var_is_arrested) then { ["Du hast dein Geld vom Bankraub bar auf die Hand erhalten. Dein Mittelsmann ist wieder untergetaucht.",2] call zero_fnc_msg; systemChat "Deutsche Bank: Du hast dein Geld vom Bankraub bar auf die Hand erhalten. Dein Mittelsmann ist wieder untergetaucht."; [1, ([3, 0] call zero_fnc_Z0Check) + _price] call zero_fnc_Z0Check; [format["BANK ROBBED: %1 ( %2 , %3) hat %4 von einem Bankraub erhalten.", player getVariable ["zero_var_realname",name player], getPlayerUID player, playerSide, _price]] call zero_fnc_zoLog; } else { "Da dein Mittelsmann dich nicht erreichen konnte, hast du kein Geld erhalten." call zero_fnc_msg; systemChat "Deutsche Bank: Da dein Mittelsmann dich nicht erreichen konnte, hast du kein Geld erhalten."; }; }else{ _shop addAction["Deutsche Bank ausrauben",zero_fnc_lokalbank,"",0,false,false,"",'player distance _target < 3 && {isNull (objectParent player)}']; zero_var_already_robbed = false; }; zero_var_restrained_lokalbank = false;
