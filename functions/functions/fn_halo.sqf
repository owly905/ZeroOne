if (!hasInterface) exitWith {}; private["_altitude","_pack","_class","_magazines","_weapons","_items","_helmet","_pos"]; _pos = param[0,[], [[]]]; _altitude = param[1,3000,[0]]; if (_altitude < 500) exitWith {}; waitUntil {(getPos player select 0) == _pos select 0 && (getPos player select 1) == _pos select 1}; cutText ["", "BLACK FADED",999]; [] spawn { uiSleep 2; "dynamicBlur" ppEffectEnable true; "dynamicBlur" ppEffectAdjust [6]; "dynamicBlur" ppEffectCommit 0; "dynamicBlur" ppEffectAdjust [0.0]; "dynamicBlur" ppEffectCommit 5; cutText ["", "BLACK IN", 5]; }; if (!isNull (unitBackpack player) && (backpack player) != "b_parachute") then { _pack = unitBackpack player; _class = typeOf _pack; _magazines = getMagazineCargo _pack; _weapons = getWeaponCargo _pack; _items = getItemCargo _pack; _helmet = headgear player; removeBackpack player; player addBackpack "b_parachute"; [_class,_magazines,_weapons,_items,_helmet,_altitude] spawn { _class = _this select 0; _magazines = _this select 1; _weapons = _this select 2; _items = _this select 3; _helmet = _this select 4; _altitude = _this select 5; [[player, "zero_var_fnc_createVehicleArray", ["GroundWeaponHolder", [0,0,0], [], 0, "CAN_COLLIDE"]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; waitUntil {!isNil "zero_var_createVehicleResponse"}; private _packHolder = zero_var_createVehicleResponse; zero_var_createVehicleResponse = nil; _packHolder addBackpackCargoGlobal [_class, 1]; waitUntil {animationState player == "HaloFreeFall_non"}; [[player, "zero_var_fnc_attachTo", [_packHolder, player, [-0.12,-0.02,-.74], "pelvis", [[0,-1,-0.05],[0,0,-1]]]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; waitUntil {animationState player == "para_pilot"}; [[player, "zero_var_fnc_attachTo", [_packHolder, vehicle player, [-0.07,0.67,-0.13], "pelvis", [[0,-0.2,-1],[0,1,0]]]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; waitUntil {isTouchingGround player || (getPos player select 2) < 1};
detach _packHolder; [_packHolder] call zero_fnc_deleteVehicle; player addBackpack _class; clearAllItemsFromBackpack player; if (_altitude > 3040 && _helmet != "" && _helmet != "H_CrewHelmetHeli_I") then {(unitBackpack player) addItemCargoGlobal [_helmet, 1]}; for "_i" from 0 to (count (_magazines select 0) - 1) do { (unitBackpack player) addMagazineCargoGlobal [(_magazines select 0) select _i,(_magazines select 1) select _i]; }; for "_i" from 0 to (count (_weapons select 0) - 1) do { (unitBackpack player) addWeaponCargoGlobal [(_weapons select 0) select _i,(_weapons select 1) select _i]; }; for "_i" from 0 to (count (_items select 0) - 1) do { (unitBackpack player) addItemCargoGlobal [(_items select 0) select _i,(_items select 1) select _i]; }; }; } else { if ((backpack player) != "b_parachute") then {player addBackpack "B_parachute"}; }; if (_altitude > 3040 && (headgear player) != "H_CrewHelmetHeli_I") then {player addHeadgear "H_CrewHelmetHeli_I"}; [[player, "zero_var_fnc_setPos", [vehicle player, [(_pos select 0), (_pos select 1), _altitude]]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; waitUntil {(getPos player select 2) >= (_altitude - 10)}; [] spawn { waitUntil {(getPos player select 2) < 150 || animationState player == "para_pilot" && alive player}; player action ["OpenParachute", player]; waitUntil {animationState player == "para_pilot"}; playSound "open_chute"; setAperture 0.05; setAperture -1; "DynamicBlur" ppEffectEnable true; "DynamicBlur" ppEffectAdjust [8.0]; "DynamicBlur" ppEffectCommit 0.01; uiSleep 1; "DynamicBlur" ppEffectAdjust [0.0]; "DynamicBlur" ppEffectCommit 3; uiSleep 3; "DynamicBlur" ppEffectEnable false; "RadialBlur" ppEffectAdjust [0.0, 0.0, 0.0, 0.0]; "RadialBlur" ppEffectCommit 1.0; "RadialBlur" ppEffectEnable false; }; [] spawn { waitUntil {isTouchingGround player || (getPos player select 2) < 1 && alive player}; playSound "close_chute"; cutText ["", "BLACK FADED", 999]; uiSleep 2; cutText ["", "BLACK IN", 2]; [[player, "zero_var_fnc_setDamage", [player, 0]], "zero_fnc_remoteExecuteCommand", zero_var_HC1_owner] call zero_fnc_sendPacket; };
